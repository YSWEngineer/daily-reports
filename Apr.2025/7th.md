# 2025/04/07(月)
## 📚 プラクティス『Ruby中級』


## 🧩 タスクばらし
- [x] プラクティスの内容を咀嚼
- [x] タスクばらし、スモールステップの作成
- [x] 各参考ページを確認
- [ ] 参考書籍：[プロを目指す人のためのRuby入門 <改訂2版>](https://www.amazon.co.jp/dp/4297124378/)を読んで、実際に手を動かしてツールを使ってみてコードを書いてみる


## 🐾 スモールステップ
<details><summary>プラクティスの内容を咀嚼</summary>

- [x] プラクティスの内容を咀嚼
</details>

<details><summary>タスクばらし、スモールステップの作成</summary>

- [x] タスクばらし、スモールステップの作成
</details>

<details><summary>各参考ページを確認</summary>

- [x] [学習を加速させるインデックス読書術](https://qiita.com/dkatsura/items/3364b293ed1451a66a8a)を再読
- [x] 動画：[著者自身が語る「プロを目指す人のためのRuby入門」の効果的な読み方](https://www.youtube.com/watch?v=qqqbHXarPO8)
</details>

<details><summary>参考書籍：プロを目指す人のためのRuby入門 <改訂2版>を読んで、実際に手を動かしてツールを使ってみてコードを書いてみる</summary>

- [x] 第1章  本書を読み進める前に
   - [x] 1.1 イントロダクション
   - [x] 1.2 本書の概要
   - [x] 1.3 Ruby について
   - [x] 1.4 Ruby のインストール
   - [x] 1.5 エディタ/IDE について
   - [x] 1.6 Ruby を動かしてみる
   - [x] 1.7 本書のサンプルコードについて
   - [x] 1.8 Ruby の公式リファレンスについて
   - [x] 1.9 この章のまとめ
- [x] 第2章  Ruby の基礎を理解する
   - [x] 2.1 イントロダクション
   - [x] 2.2 Ruby に関する基礎知識
   - [x] 2.3 文字列
   - [x] 2.4 数値
   - [x] 2.5 真偽値と条件分岐
   - [x] 2.6 メソッドの定義
   - [x] 2.7 例題：FizzBuzzプログラムを作成する
   - [x] 2.8 文字列についてもっと詳しく
   - [x] 2.9 数値についてもっと詳しく
   - [x] 2.10 真偽値と条件分岐についてもっと詳しく
   - [x] 2.11 メソッド定義についてもっと詳しく
   - [x] 2.12 そのほかの基礎知識
   - [x] 2.13 この章のまとめ
- [x] 第3章  テストを自動化する
   - [x] 3.1 イントロダクション
   - [x] 3.2 Minitest の基本
   - [x] 3.3 FizzBuzzプログラムのテスト自動化
   - [x] 3.4 この章のまとめ
- [x] 第4章  配列や繰り返し処理を理解する
   - [x] 4.1 イントロダクション
   - [x] 4.2 配列
   - [x] 4.3 ブロック
   - [x] 4.4 ブロックを使う配列のメソッド
   - [x] 4.5 範囲（Range）
   - [x] 4.6 例題：RGB変換プログラムを作成する
   - [x] 4.7 配列についてもっと詳しく
   - [x] 4.8 ブロックについてもっと詳しく
   - [x] 4.9 範囲（Range）についてもっと詳しく
   - [x] 4.10 さまざまな繰り返し処理
   - [x] 4.11 繰り返し処理用の制御構造
   - [x] 4.12 この章のまとめ
- [x] 第5章  ハッシュやシンボルを理解する
   - [x] 5.1 イントロダクション
   - [x] 5.2 ハッシュ
   - [x] 5.3 シンボル
   - [x] 5.4 続・ハッシュについて
   - [x] 5.5 例題：長さの単位交換プログラムを作成する
   - [x] 5.6 ハッシュとキーワード引数についてもっと詳しく
   - [x] 5.7 シンボルについてもっと詳しく
   - [x] 5.8 この章のまとめ
- [x] 第6章  正規表現を理解する
   - [x] 6.1 イントロダクション
   - [x] 6.2 正規表現って何？
   - [x] 6.3 Ruby における正規表現オブジェクト
   - [x] 6.4 例題：Ruby のハッシュ記法を変換する
   - [x] 6.5 正規表現オブジェクトについてもっと詳しく
   - [x] 6.6 この章のまとめ
- [x] 第7章  クラスの作成を理解する
   - [x] 7.1 イントロダクション
   - [x] 7.2 オブジェクト指向プログラミングの基礎知識
   - [x] 7.3 クラスの定義
   - [x] 7.4 例題：改札機プログラムの作成
   - [x] 7.5 selfキーワード
   - [x] 7.6 クラスの継承
   - [x] 7.7 メソッドの可視性
   - [x] 7.8 定数についてもっと詳しく
   - [x] 7.9 さまざまな種類の変数
   - [x] 7.10 クラス定義や Ruby の言語使用に関する高度な話題
   - [x] 7.11 この章のまとめ
- [x] 第8章  モジュールを理解する
   - [x] 8.1 イントロダクション
   - [x] 8.2 モジュールの概要
   - [x] 8.3 モジュールを利用したメソッド定義（include と extend）
   - [x] 8.4 例題：rainbowメソッドの作成
   - [x] 8.5 モジュールを利用したメソッド定義についてもっと詳しく
   - [x] 8.6 モジュールを利用した名前空間の作成
   - [x] 8.7 関数や定数を提供するモジュールの作成
   - [x] 8.8 状態を保持するモジュールの作成
   - [x] 8.9 モジュールに関する高度な話題
   - [x] 8.10 この章のまとめ
- [x] 第9章  例外処理を理解する
   - [x] 9.1 イントロダクション
   - [x] 9.2 例外の捕捉
   - [x] 9.3 意図的に例外を発生させる
   - [x] 9.4 例外処理のベストプラクティス
   - [x] 9.5 例題：正規表現チェッカープログラムの作成
   - [x] 9.6 例外処理についてもっと詳しく
   - [x] 9.7 この章のまとめ
- [ ] 第10章  yield と Proc を理解する
   - [x] 10.1 イントロダクション
   - [x] 10.2 ブロックを利用するメソッドの定義と yield
   - [x] 10.3 Procオブジェクト
   - [x] 10.4 例題：ワードシンセサイザーの作成
   - [ ] 10.5 Procオブジェクトについてもっと詳しく
   - [ ] 10.6 この章のまとめ
- [ ] 第11章  パターンマッチを理解する
   - [ ] 11.1 イントロダクション
   - [ ] 11.2 パターンマッチの基本
   - [ ] 11.3 パターンマッチの利用パターン
   - [ ] 11.4 例題：ログフォーマッターの作成
   - [ ] 11.5 パターンマッチについてもっと詳しく
   - [ ] 11.6 この章のまとめ
- [ ] 第12章  Ruby のデバッグ技法を身につける
   - [ ] 12.1 イントロダクション
   - [ ] 12.2 バックトレースの読み方
   - [ ] 12.3 よく発生する例外クラスとその原因
   - [ ] 12.4 プログラムの途中経過を確認する
   - [ ] 12.5 汎用的なトラブルシューティング方法
   - [ ] 12.6 この章のまとめ
- [ ] 第13章  Ruby に関するその他のトピック
   - [ ] 13.1 イントロダクション
   - [ ] 13.2 日付や時刻の扱い
   - [ ] 13.3 ファイルやディレクトリの扱い
   - [ ] 13.4 特定の形式のファイルを読み書きする
   - [ ] 13.5 環境変数や起動時引数の取得
   - [ ] 13.6 非推奨機能を使ったときに警告を出力する
   - [ ] 13.7 eval、バッククオートリテラル、sendメソッド
   - [ ] 13.8 Rake
   - [ ] 13.9 gem と Bundler
   - [ ] 13.10 Ruby における型情報の定義と型検査（RBS、TypeProf、Steep）
   - [ ] 13.11 「Rails の中の Ruby」と「素の Ruby」の違い
   - [ ] 13.12 この章のまとめ

</details>


---


## 🧑🏻‍💻 本日の取り組み
### プラクティス『Ruby中級』
- 参考書籍：『プロを目指す人のためのRuby入門 <改訂2版>』を読み進める
  - 第10章  例外処理を理解する
    - 10.4 例題：ワードシンセサイザーの作成
      - エフェクトの実装方法を検討する
      - テストコードも2つに分ける
      - テストコードを準備する
      - リバースエフェクトを実装する
      - エコーエフェクトを実装する
      - ラウドエフェクトを実装する
      - WordSynthクラスの実装とテスト 


---


## 🎯 次回
### プラクティス『Ruby中級』
- 参考書籍：『プロを目指す人のためのRuby入門 <改訂2版>』を読み進める
  - 第10章  yield と Proc を理解する
    - 10.5 Procオブジェクトについてもっと詳しく
      - Procオブジェクトを実行する様々な方法 〜
    

---


## 💡 本日の学び・気付き
### 10.4 例題：ワードシンセサイザーの作成
#### エフェクトの実装方法を検討する
今回の例題のポイントは各エフェクトをどのように実装するかである。各エフェクトは次のような要件を満たす必要がある。

- call というメソッドを持つ。
- callメソッドは 1 つの引数を受け取る。
- callメソッドは引数に対して何らかの効果を適用し、それを戻り値として返す。

これらのエフェクトは Procオブジェクトであればよい。ぐらい的には次のようなコードになる。
```ruby
module Effects
  def self.reverse
    # Procオブジェクト（ラムダ）をメソッドの戻り値にする
    ->(words) do
      # スペースで分解 > 逆順に並び替え > スペースで連結
      words.split(' ').map(&:reverse).join(' ')
    end
  end
end
```

#### テストコードを準備する
まず、testディレクトリに effects_test.rb と word_synth_test.rb を作成する。次に、effects_test.rb を開き、次のコードを書く。
```ruby
require 'minitest/autorun'
require_relative '../lib/effects'

class EffectsTest < Minitest::Test
  def test_reverse
    # とりあえずモジュールが参照できることを確認する
    assert Effects
  end
end
```
word_synth_test.rb にも次のコードを書く。
```ruby
require 'minitest/autorun'
require_relative '../lib/word_synth'
require_relative '../lib/effects'

class WordSynthTest < Minitest::Test
  def test_play
    # とりあえずクラスとモジュールが参照できることを確認する
    assert WordSynth
    assert Effects
  end
end
```
続いて、libディレクトリに effects.rb と word_synth.rb を作成する。effects.rb を開いて、Effectsモジュールを定義する。
```ruby
module Effects
  def self.reverse
    # 実装はあとで
  end
end
```
同様に word_synth.rb にも WordSynthクラスを作っておく。
```ruby
class WordSynth
  def play(original_words)
    # 実装はあとで
  end
end
```
2つのテストを実行してパスすることを確認する。
```shell
~/ruby-book % ruby test/effects_test.rb
Run options: --seed 59919

# Running:

.

Finished in 0.000932s, 1072.9614 runs/s, 1072.9614 assertions/s.

1 runs, 1 assertions, 0 failures, 0 errors, 0 skips
```
```shell
~/ruby-book % ruby test/word_synth_test.rb
Run options: --seed 57335

# Running:

.

Finished in 0.000724s, 1381.2154 runs/s, 2762.4309 assertions/s.

1 runs, 2 assertions, 0 failures, 0 errors, 0 skips
```

#### リバースエフェクトを実装する
リバースエフェクトから作成する。effects_test.rb を開き次のコードを書く。
```ruby
require 'minitest/autorun'
require_relative '../lib/effects'

class EffectsTest < Minitest::Test
  def test_reverse
    effect = Effects.reverse
    assert_equal 'ybuR si !nuf', effect.call('Ruby is fun!')
  end
end
```
この状態でテストコードを実装するとテストは失敗する。
```shell
~/ruby-book % ruby test/effects_test.rb 
Run options: --seed 47411

# Running:

E

Finished in 0.000937s, 1067.2359 runs/s, 0.0000 assertions/s.

  1) Error:
EffectsTest#test_reverse:
NameError: undefined local variable or method `effects' for an instance of EffectsTest
    test/effects_test.rb:7:in `test_reverse'

1 runs, 0 assertions, 0 failures, 1 errors, 0 skips
```
effects.rb を開いてリバースエフェクトを実装する。コードは先ほどのをそのまま使用する。
```ruby
module Effects
  def self.reverse
    ->(words) do
      words.split(' ').map(&:reverse).join(' ')
    end
  end
end
```
```shell
~/ruby-book % ruby test/effects_test.rb
Run options: --seed 55559

# Running:

.

Finished in 0.001430s, 699.3007 runs/s, 699.3007 assertions/s.

1 runs, 1 assertions, 0 failures, 0 errors, 0 skips
```

#### エコーエフェクトを実装する
エコーエフェクトもテストコードの実装から始める。
```ruby
require 'minitest/autorun'
require_relative '../lib/effects'

class EffectsTest < Minitest::Test
  def test_reverse
    effect = Effects.reverse
    assert_equal 'ybuR si !nuf', effect.call('Ruby is fun!')
  end

  def test_echo
    effect = Effects.echo(2)
    assert_equal 'RRuubbyy iiss ffuunn!!', effect.call('Ruby is fun!')

    effect = Effects.echo(3)
    assert_equal 'RRRuuubbbyyy iiisss fffuuunnn!!!', effect.call('Ruby is fun!')
  end
end
```
実行してテストを失敗させる。
```shell
~/ruby-book % ruby test/effects_test.rb 
Run options: --seed 47667

# Running:

.E

Finished in 0.001486s, 1345.8950 runs/s, 672.9475 assertions/s.

  1) Error:
EffectsTest#test_echo:
NoMethodError: undefined method `echo' for module Effects
    test/effects_test.rb:11:in `test_echo'

2 runs, 1 assertions, 0 failures, 1 errors, 0 skips
```
エコーエフェクトの実装に移る。実装コードは次のようになる。
```ruby
module Effects
  def self.reverse
    ->(words) do
      words.split(' ').map(&:reverse).join(' ')
    end
  end

  def self.echo(rate)
    ->(words) do
      # スペースならそのまま返す
      # スペース以外ならその文字を指定された回数だけ繰り返す
      words.each_char.map { |c| c == ' ' ? c : c * rate }.join
    end
  end
end
```
エコーエフェクトでは文字列を1文字ずつ分解して、それぞれの文字を加工し、最後にまた joinメソッドで全ての文字を連結している。
```shell
~/ruby-book % ruby test/effects_test.rb 
Run options: --seed 58272

# Running:

..

Finished in 0.001258s, 1589.8251 runs/s, 2384.7377 assertions/s.

2 runs, 3 assertions, 0 failures, 0 errors, 0 skips
```

#### ラウドエフェクトを実装する
まず、テストコードを用意する。
```ruby
require 'minitest/autorun'
require_relative '../lib/effects'

class EffectsTest < Minitest::Test
  def test_reverse
    effect = Effects.reverse
    assert_equal 'ybuR si !nuf', effect.call('Ruby is fun!')
  end

  def test_echo
    effect = Effects.echo(2)
    assert_equal 'RRuubbyy iiss ffuunn!!', effect.call('Ruby is fun!')

    effect = Effects.echo(3)
    assert_equal 'RRRuuubbbyyy iiisss fffuuunnn!!!', effect.call('Ruby is fun!')
  end

  def test_loud
    effect = Effects.loud(2)
    assert_equal 'Ruby!! IS!! FUN!!!', effect.call('Ruby is fun!')

    effect = Effects.loud(3)
    assert_equal 'Ruby!!! IS!!! FUN!!!!', effect.call('Ruby is fun!')
  end
end
```
続いてテストコードを失敗させる。
```shell
~/ruby-book % ruby test/effects_test.rb 
Run options: --seed 11230

# Running:

..E

Finished in 0.000979s, 3064.3514 runs/s, 3064.3514 assertions/s.

  1) Error:
EffectsTest#test_loud:
NameError: uninitialized constant EffectsTest::Effetcs
    test/effects_test.rb:19:in `test_loud'

3 runs, 3 assertions, 0 failures, 1 errors, 0 skips
```
ラウドエフェクトを実装する。次のようなコードを使う。
```ruby
module Effects
  def self.reverse
    ->(words) do
      words.split(' ').map(&:reverse).join(' ')
    end
  end

  def self.echo(rate)
    ->(words) do
      # スペースならそのまま返す
      # スペース以外ならその文字を指定された回数だけ繰り返す
      words.each_char.map { |c| c == ' ' ? c : c * rate }.join
    end
  end

  def self.loud(level)
    ->(words) do
      # スペースで分割 > 大文字変換と"!"の付与 > スペースで連結
      words.split(' ').map { |word| word.upcase + '!' * level }.join(' ')
    end
  end
end
```
```shell
~/ruby-book % ruby test/effects_test.rb
Run options: --seed 56808

# Running:

...

Finished in 0.001060s, 2830.1887 runs/s, 4716.9811 assertions/s.

3 runs, 5 assertions, 0 failures, 0 errors, 0 skips
```

#### WordSynthクラスの実装とテスト
word_synth_test.rb を開き、test_playメソッドは削除して、以下のコードを書く。
```ruby
class WordSynthTest < Minitest::Test
  def test_play_without_effects
    synth = WordSynth.new
    assert_equal 'Ruby is fun!', synth.play('Ruby is fun!')
  end
end
```
WordSynthクラスはまだ実装コードを書いていないため、テストは失敗する。
```shell
~/ruby-book % ruby test/word_synth_test.rb 
Run options: --seed 4950

# Running:

F

Finished in 0.003327s, 300.5711 runs/s, 300.5711 assertions/s.

  1) Failure:
WordSynthTest#test_play_without_effects [test/word_synth_test.rb:8]:
Expected: "Ruby is fun!"
  Actual: nil

1 runs, 1 assertions, 1 failures, 0 errors, 0 skips
```
以下の実装コードを word_synth.rb に記述する。
```ruby
class WordSynth
  def initialize
    @effects = []
  end

  def add_effect(effect)
    @effects << effect
  end

  def play(original_words)
    words = original_words
    @effects.each do |effect|
      words = effect.call(words)
    end
    words
  end
end
```
テストを実行してみる。
```shell
~/ruby-book % ruby test/word_synth_test.rb
Run options: --seed 19432

# Running:

.

Finished in 0.001095s, 913.2420 runs/s, 913.2420 assertions/s.

1 runs, 1 assertions, 0 failures, 0 errors, 0 skips
```
エフェクトを適用するケースをテストする。最初はリバースエフェクトを適用する場合。
```ruby
require 'minitest/autorun'
require_relative '../lib/word_synth'
require_relative '../lib/effects'

class WordSynthTest < Minitest::Test
  def test_play_without_effects
    synth = WordSynth.new
    assert_equal 'Ruby is fun!', synth.play('Ruby is fun!')
  end

  def test_play_with_reverse
    synth = WordSynth.new
    synth.add_effect(Effects.reverse)
    assert_equal 'ybuR si !nuf', synth.play('Ruby is fun!')
  end
end
```
コードは全部完成しているので、テストはパスするはず。
```shell
~/ruby-book % ruby test/word_synth_test.rb 
Run options: --seed 37188

# Running:

..

Finished in 0.000772s, 2590.6736 runs/s, 2590.6736 assertions/s.

2 runs, 2 assertions, 0 failures, 0 errors, 0 skips
```
続けて複数のエフェクトを適用する場合をテストする。
```ruby
require 'minitest/autorun'
require_relative '../lib/word_synth'
require_relative '../lib/effects'

class WordSynthTest < Minitest::Test
  def test_play_without_effects
    synth = WordSynth.new
    assert_equal 'Ruby is fun!', synth.play('Ruby is fun!')
  end

  def test_play_with_reverse
    synth = WordSynth.new
    synth.add_effect(Effects.reverse)
    assert_equal 'ybuR si !nuf', synth.play('Ruby is fun!')
  end

  def test_play_with_many_effects
    synth = WordSynth.new
    synth.add_effect(Effects.echo(2))
    synth.add_effect(Effects.loud(3))
    synth.add_effect(Effects.reverse)
    assert_equal '!!!YYBBUURR !!!SSII !!!!!NNUUFF', synth.play('Ruby is fun!')
  end
end
```
エフェクトと WordSynthクラスが実装されていれば、テストコードは動くはず。
```shell
~/ruby-book % ruby test/word_synth_test.rb
Run options: --seed 12739

# Running:

...

Finished in 0.000894s, 3355.7047 runs/s, 3355.7047 assertions/s.

3 runs, 3 assertions, 0 failures, 0 errors, 0 skips
```
本当にテストが機能していることを確認するために、エフェクトを1つ外してテストをわざと失敗させる。
```ruby
require 'minitest/autorun'
require_relative '../lib/word_synth'
require_relative '../lib/effects'

class WordSynthTest < Minitest::Test
  def test_play_without_effects
    synth = WordSynth.new
    assert_equal 'Ruby is fun!', synth.play('Ruby is fun!')
  end

  def test_play_with_reverse
    synth = WordSynth.new
    synth.add_effect(Effects.reverse)
    assert_equal 'ybuR si !nuf', synth.play('Ruby is fun!')
  end

  def test_play_with_many_effects
    synth = WordSynth.new
    synth.add_effect(Effects.echo(2))
    synth.add_effect(Effects.loud(3))
    # synth.add_effect(Effects.reverse)
    assert_equal '!!!YYBBUURR !!!SSII !!!!!NNUUFF', synth.play('Ruby is fun!')
  end
end
```
```shell
~/ruby-book % ruby test/word_synth_test.rb
Run options: --seed 5625

# Running:

.F.

Finished in 0.028034s, 107.0129 runs/s, 107.0129 assertions/s.

  1) Failure:
WordSynthTest#test_play_with_many_effects [test/word_synth_test.rb:22]:
--- expected
+++ actual
@@ -1 +1 @@
-"!!!YYBBUURR !!!SSII !!!!!NNUUFF"
+"RRUUBBYY!!! IISS!!! FFUUNN!!!!!"


3 runs, 3 assertions, 1 failures, 0 errors, 0 skips
```
ちゃんと失敗しているので、大丈夫。

---


## ✍🏻 感想
### 🤷🏻 人手不足
数日ぶりの学習です。現在、勤め先の百貨店内だけでなく、他のお店も慢性的な人手不足に悩んでいるようです。（ヘルプとして入っていたため）連続出勤を終え、今週からは通常の出勤に戻ります。まだ疲れが溜まっているので、さっそくシャワーを浴びて休むことにします。（勉強の感想ではなくすみません🙏🏻）


---


### ⏰ 学習時間
- Today:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2 hours 40 min
- Total: 1038 hours 47 min
