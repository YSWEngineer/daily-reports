# 2025/12/20(土)
## 📚 プラクティス『🛠️💻 lsコマンドを作る2』

<details><summary>🎯 学習の狙い</summary>

- 標準出力について学ぶ
- 標準ライブラリの使い方を学ぶ
- Enumeratorには、each以外にも便利なメソッドがあることを学ぶ
- RailsじゃないRubyプログラミングを学ぶ
- メソッド分割を学ぶ
- わかりやすい変数名・メソッド名を学ぶ
- 大きな問題を分割する力を学ぶ
</details>

<details><summary>📌 要件（Docs：lsコマンドを作る 参照）</summary>

- [x] `-a`オプションを付けたとき、`.`で始まる隠しファイルも表示対象にする
- [x] ⚠️ 注意事項：`..`は表示されなくてもよい
- [x] そのまま実行すると、今いるフォルダ（カレントディレクトリ）の中身を表示する
- [x] `gem`は使わずに Ruby の標準ライブラリだけで作ること
- [ ] 完成したコードは GitHub の Pull Request として提出すること
- [ ] `rubocop-fjord`でデバッグを実行し、全てパスさせること
- [x] 表示は横に最大3列になるようにレイアウトすること
  - 3, 6, 9, 12のように3の倍数の件数だけでなく、最後の列に空欄ができるケースの結果も載せる
  - 「3列から5列に仕様変更してください」または「3列から100列に変えてください」とあとから言われても必要最小限の変更で対応できるようなロジックにしておくこと
</details>

<details><summary>📍 処理の流れ ※ 随時、追加・変更あり</summary>

**1. オプションの有無を判定**

**2. ファイル一覧取得**

**3. 出力するファイルを選別（隠しファイルを含む or 含まない）**

**4. 表示するための整形**

**5. 1 〜 4 を踏まえた上での出力**
</details>

<details><summary> 🧩 タスクばらし ※ 随時、追加・変更あり</summary>

- [x] タスク1：前提の整理
  - [x] `ls`コマンド、`-a`オプションについて確認

- [x] タスク2：`-a`オプションを受け取れる状態にする
  - [x] `OptionParser`を使用して引数を確認する
  - [x] `-a`オプションを含む処理 / 含まない処理を分けて考える（条件分岐🤔）

- [x] タスク3：ディレクトリの中身を取得

- [x] タスク4：隠しファイルの扱いを決める
  - [x] `-a`オプションが付いているなら`.`から始まるファイルを表示させる
  - [x] `-a`オプションが付いていないなら隠しファイルは表示させない

- [x] タスク5：レイアウトの調整
  - [x] 『lsコマンドを作る1』で作成したレイアウトの処理をそのまま使用🤔
  - [x] `-a`オプションを使ったときに隠しファイルが表示されるようにする

- [ ] タスク6：rubocop-fjord に通す

- [ ] タスク7：提出
  - [ ] 作成した lsコマンドを Pull Request として提出
  - [ ] 提出物にlsコマンドの実行結果とOS標準（macなど自分の使ってるOS）のlsコマンドをのスクリーンショットを併記して貼る
  - [ ] rubocop-fjord のチェックが全てパスした画面をスクショして添付
</details>


---


## 🧑🏻‍💻 本日の取り組み
### 📚 プラクティス『🛠️💻 lsコマンドを作る2』 
- `-a`オプション実装


---


## ⏭️ 次回
### 📚 プラクティス『🛠️💻 lsコマンドを作る2』
- rubocop-fjord に通す
- 作成した lsコマンドを Pull Request として提出
- メンターさんに課題を提出


---


### 💡 本日の学び・気付き
#### -aオプションの実装
<details><summary>⚠️ ネタバレに注意 </summary>

```ruby
# frozen_string_literal: true
#!/usr/bin/env ruby
require 'optparse'

# -aオプションが付いたかどうかを記録
show_hidden = false

# オプション解析の準備
opt = OptionParser.new
opt.on('-a') do
  show_hidden = true
end

# コマンドライン引数を解析
opt.parse!(ARGV)

# Dir.entries('.') で取得した一覧から「.」と「..」を除外
files = Dir.entries('.').reject { |file| file == '.' || file == '..' }

# -aオプションがない場合は、隠しファイルは除外
unless show_hidden
  files = files.reject { |file| file.start_with?('.') }
end

# 並び替える
files = files.sort

COLUMNS = 3
rows = (files.size.to_f / COLUMNS).ceil

def max_length(files)
  (files.map(&:length).max || 0) + 1
end

def build_line(files, row, rows, columns, max_length)
  line = ''

  columns.times do |column|
    index = row + column * rows
    name = files[index] || ''
    line += name.ljust(max_length)
  end

  line
end

def print_rows(files, rows, columns, max_length)
  rows.times do |row|
    puts build_line(files, row, rows, columns, max_length)
  end
end

print_rows(files, rows, COLUMNS, max_length(files))

```

#### lsコマンドに-aオプションを実装するための考え方
##### 1. -aオプションの役割を明確にする
`ls -a`の役割はとてもシンプルで、
- `-a`オプションが付いているとき
→ファイル名の先頭が`.`（ピリオド）の**隠しファイル**も表示する。
- `-a`オプションが付いていないとき
→ 隠しファイルは表示しない。

つまり、「表示するファイルの条件が変わるだけ」だと考えた。
プラクティスの内容に記載されているように、表示方法や並び方はすでに作成済みのコードをそのまま使用。

##### 2. 「分岐」が必要になる理由を考える
`-a`オプションの有無によって挙動が変わるため、処理の途中で **Yes / No の分岐**が発生すると考えた。

そこで、
- `-a`オプションが指定されたかどうかを記録する変数（箱）を用意。
- その変数の内容によって、ファイルの扱いを分ける。

という方針にした。

##### 3. OptionParserで「-aが付いたか」を判断する
`OptionParser`を使い、
- `-a`オプションが指定された場合に`true`（`.`から始まるファイル名を表示）にする、という仕組みを作成。

##### 4. フラグを使ってファイル一覧を切り替える
ファイル一覧は一度取得し、そこから、
- `.`と`..`は常に除外。
- `-a`が付いていない場合のみ、ファイル名が`.`で始まるものを除外。

という順序で処理を行うようにした。
これにより、
- `-a`オプションがある場合 → 全て表示
- `-a`オプションがない場合 → 隠しファイルを除外

という動きを、条件分岐で作成。

##### 5. 既存の表示ロジックは変更しない
『lsコマンドを作る1』で作成した、表示するためのロジックは弄らず、そのまま使用。

##### まとめると
- `-a`オプションは、「表示条件を切り替えるための機能」。
- そのために**条件分岐**を使用。
- `OptionParser`で「`-a`が指定されたか」を判断する。
- ファイル一覧を作る処理だけを実装し、表示処理のロジックはそのまま再利用。

この方針で実装。
</details>


---


## ✍🏻 感想
### 🫠 何とか書けた......
今回の日報は Part.4 ですが、その裏ではコードを考えては書き、消して、調べて、また考えて......という試行錯誤を空いた時間に少しずつ繰り返してきました。体感としては、すでに Part.20 を超えている気がします。

次回は、rubocop-fjord のチェックを通し、提出まで辿り着くことを目標に進めていきます。


---


### ⏰ 学習時間
- Today:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 6 hours 06 min
- Total: 1450 hours 24 min
