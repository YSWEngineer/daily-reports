# 2026/02/10(火)
## 📚 プラクティス『🛠️💻 lsコマンドを作る4』

<details><summary>🎯 学習の狙い</summary>

- 標準出力について学ぶ
- 標準ライブラリの使い方を学ぶ
- Enumeratorには、each以外にも便利なメソッドがあることを学ぶ
- RailsじゃないRubyプログラミングを学ぶ
- メソッド分割を学ぶ
- わかりやすい変数名・メソッド名を学ぶ
- 大きな問題を分割する力を学ぶ
</details>

<details><summary>📌 要件 ※ 随時、追加・変更あり</summary>

- [ ] `-l`オプションが指定された場合は、各ファイルについて「詳細情報（long format）」を一行ずつ表示すること
- [ ] `-l`オプションが指定されていない場合は、これまで通りファイル名のみを表示すること
- [ ] 表示する詳細情報は、以下の内容を含ませること
  - [ ] ファイルタイプ
  - [ ] ファイルモード
  - [ ] リンク数
  - [ ] 所有者
  - [ ] 所有グループ
  - [ ] サイズ
  - [ ] タイムスタンプ（更新日時）
  - [ ] ファイル名もしくはディレクトリ名
- [ ] `gem`は使わずに Ruby の標準ライブラリだけで作ること
- [ ] `rubocop-fjord`でデバッグを実行し、全てパスさせること
- [ ] 完成したコードは GitHub の Pull Request として提出すること

</details>

<details><summary>📍 処理の流れ ※ 随時、追加・変更あり</summary>

1. コマンドライン引数から`-l`オプションの有無を判定する

2. 対象のディレクトリのファイル一覧を配列として取得する

3. `-l`オプションが指定されていない場合 → これまで通り、ファイル名の配列をそのまま表示する

4. `-l`オプションが指定されている場合 → ①配列の各要素（各ファイル）について詳細情報を取得する / ②取得した複数の属性を一行の文字列に整形する

5. 整形済みの各行を上から順に標準出力へ表示させる
</details>

<details><summary> 🧩 タスクばらし ※ 随時、追加・変更あり</summary>

- [ ] タスク1：コマンドライン引数を解析し、`-l`オプションの有無を取得する
- [ ] タスク2：対象のディレクトリのファイル一覧を配列として取得する
- [ ] タスク3：「一つのファイルについて、どんな情報が取れるのか」を調べる
  - [x] ファイルタイプ
  - [x] ファイルモード
  - [x] リンク数
  - [ ] 所有者
  - [ ] 所有グループ
  - [ ] サイズ
  - [ ] タイムスタンプ（更新日時）
- [ ] タスク4：取得した「詳細情報（各属性）」を表示する
  - [ ] 先ずはバラバラに値を取り出せるようにする
- [ ] タスク5：複数の属性を整形して表示する
  - [ ] 横に並べて一行にする
- [ ] タスク6：タスク3〜5で行った処理を全てのファイルに対して適用する
  - [ ] 先ずは1ファイルで成功させる
  - [ ] 次に`each`で各ファイルに処理を適用させる
- [ ] タスク7：`-l`オプションが指定されていないときに、`ls`コマンドと同じ挙動になることを確認する
- [ ] タスク8：rubocop-fjord に通す
- [ ] タスク9：提出
  - [ ] 作成した lsコマンドを Pull Request として提出
  - [ ] 提出物に、`ls -l`コマンドの実行結果と、OS標準（macなど自分の使ってるOS）の`ls -l`コマンドの実行結果のスクリーンショットを併記して貼る
  - [ ] rubocop-fjord のチェックが全てパスした画面をスクショして添付
</details>


---


## 🧑🏻‍💻 本日の取り組み
### 📚 プラクティス『🛠️💻 lsコマンドを作る4』 
- ハードリンクやディレクトリの`nlink`を実際に観察
- 観察結果から「`nlink`とは何か」を理解

---


## ⏭️ 次回
### 📚 プラクティス『lsコマンドを作る4』
- `ls -l`の`nlink`の表示を Ruby で実装する


---


## 💡 本日の学び・気付き
### ruby -e とワンライナー（one-liner）について
`-e`は「引数として渡した文字列をそのまま Ruby のコードとして実行する」オプション。ファイルを作らずに簡易スクリプトを実行したいときに便利。

基本形
```shell
ruby -e 'Rubyのコード'
```
例）文字列を出力
```shell
ruby -e 'puts "Hello!"'
```
ワンライナーとは**一行で完結するスクリプト**のこと。Ruby、Perl、Pythonなどでよく使用される。

例）1〜5をカンマ区切りで出力
```shell
ruby -e 'print (1..5).to_a.join(",")'
```

#### 🔗 参照リンク
- [rbコマンドを使ったrubyワンライナーの世界](https://zenn.dev/jy8752/articles/feaa53b24f71e9?utm_source=chatgpt.com)
- [ワンライナーでよく使うコマンドラインオプション](https://blog.ingage.jp/entry/2025/05/16/180104?utm_source=chatgpt.com)
- [Record separators](https://learnbyexample.github.io/learn_ruby_oneliners/record-separators.html?utm_source=chatgpt.com)

---

### nlinkの挙動を観察
#### nlink観察に使った構成
```shell
nlink_file.txt   # 元ファイル
nlink_file_link.txt   # ハードリンクとして作成
dir_for_nlink/   # nlink増減を調べるディレクトリ
```

#### STEP1：ファイルを作成（nlink = 1）
先ずは、`nlink = 1`の普通のファイルを作成するところから。
```shell
~/stat_check % echo "hello" > nlink_file.txt
~/stat_check % ls
file.txt                nlink_file.txt          stat_perm_check.rb      test_dir
link_to_file            stat_link_check.rb      stat_type_check.rb
~/stat_check % cat nlink_file.txt
hello
```
- `echo "hello"`
→ "hello"という文字列を出力する。
- `>`
→ 出力内容をファイルへ書き込むリダイレクト。
→リダイレクトとは、標準入出力先を変更する機能のこと。**リダイレクト先のファイルは自動的に作成される**。
- `nlink_file.txt`
→ この名前でファイルを新しく作成する。

結果：`nlink_file.txt`というファイルが作られ、中身は"hello"。

#### STEP2：作成したファイルのリンク数（nlink）を確認
`ls -l`コマンド（UNIXコマンド）で確認。
```shell
~/stat_check % ls -l nlink_file.txt
-rw-r--r--@ 1 yoshiwo  staff  6 Feb 10 17:33 nlink_file.txt   # リンク数が1だと分かる
```
Ruby の`File.stat`で確認。
```shell
~/stat_check % ruby -e "puts File.stat('nlink_file.txt').nlink"
1   # 作成したnlink_file.txtファイルのリンク数が1だと確認できた
```
- `ruby -e`
→ Ruby のワンライナーを実行する。
→ ワンライナーとは、一行だけで記述されたプログラムのこと。
- `File.stat('nlink_file.txt')`
→ ファイル情報を取得。
- `nlink`
→ リンク数を取り出すメソッド。
- `puts`
→ 結果を表示する。

#### STEP3：ハードリンクを張る
`nlink`が増えるのを確認するために、リンク（別名）を追加する。
```shell
~/stat_check % ln nlink_file.txt nlink_file_link.txt
```
- `ln`
→ リンク（ハードリンク）を張る（作成する）コマンド。
- `nlink_file.txt`
→ 元のファイル。
- `nlink_file_link.txt`
→ 新しく作るリンク名（= 別名）。

#### STEP4：リンク数が増えたことを確認
`ls -l`コマンドで確認。
```shell
# 元のファイル
~/stat_check % ls -l nlink_file.txt
-rw-r--r--@ 2 yoshiwo  staff  6 Feb 10 17:33 nlink_file.txt

# 新しく作ったリンク名（別名）
~/stat_check % ls -l nlink_file_link.txt
-rw-r--r--@ 2 yoshiwo  staff  6 Feb 10 17:33 nlink_file_link.txt
```
どちらも`2`になっている。

Ruby で確認。
```shell
~/stat_check % ruby -e "puts File.stat('nlink_file.txt').nlink"
2
~/stat_check % ruby -e "puts File.stat('nlink_file_link.txt').nlink"
2
```
どちらも`2`が表示されている。

#### STEP5：観察用のディレクトリを作成
```shell
~/stat_check % mkdir dir_for_nlink
~/stat_check % ls
dir_for_nlink           link_to_file            nlink_file_link.txt     stat_perm_check.rb      test_dir
file.txt                nlink_file.txt          stat_link_check.rb      stat_type_check.rb
```

#### STEP6：作成した直後のディレクトリのnlinkを確認
`ls -ld`コマンドで確認。
```shell
~/stat_check % ls -ld dir_for_nlink
drwxr-xr-x@ 2 yoshiwo  staff  64 Feb 10 20:07 dir_for_nlin
```
- `ls -l`
→ 詳細表示。
- `-d`
→ 「対象がディレクトリである」という意味。
- `dir_for_nlink`
→ 対象のディレクトリ。

ディレクトリは作成した直後、通常のリンク数は`2`になる。
- 1つめ：`dir_for_nlink`自身
- 2つめ：`dir_for_nlink/.`というリンク

Ruby でも確認。
```shell
~/stat_check % ruby -e "puts File.stat('dir_for_nlink').nlink"
2
```
これも`2`が表示される。

#### STEP7：ディレクトリの中にファイルを追加する
`dir_for_nlink`ディレクトリの中にファイルを1つ作成する。
```shell
~/stat_check % touch dir_for_nlink/a
~/stat_check/dir_for_nlink % ls
a
```
- `touch dir_for_nlink/a`
→ `dir_for_nlink`ディレクトリの中に`a`というファイルを作成。
→ **「ファイルが1つできる」ということは、そのディレクトリに新しいリンクが1つ増えるということ。**

#### STEP8：ディレクトリのnlinkが増えたか確認
`ls -ld`コマンドで確認。
```shell
~/stat_check % ls -ld dir_for_nlink
drwxr-xr-x@ 3 yoshiwo  staff  96 Feb 10 20:23 dir_for_nlink
```
リンク数が`3`になっている。

Ruby でも確認。
```shell
~/stat_check % ruby -e "puts File.stat('dir_for_nlink').nlink"
3
```
こちらも`3`であることを確認。

#### 補足：何故ディレクトリはサブエントリでnlinkが増えるのか？
ディレクトリの中の1つ1つの名前（エントリ）が「そのディレクトリを指すリンク」になっているため。

フォルダの階層が深くなるほど、「親ディレクトリから見てそのディレクトリを参照する`..`」も増えていく構造になっている。

#### 🔗 参照リンク
[Why is number of hard links for a directory 2 + the number of subdirectories?
](https://stackoverflow.com/questions/67992991/why-is-number-of-hard-links-for-a-directory-2-the-number-of-subdirectories?utm_source=chatgpt.com)

---


## ✍🏻 感想
### 🫂 nlink と仲良くなりたい！
今日は`nlink`というまだ馴染みのない概念を、自分の手で操作しながら挙動を観察できたことが大きな収穫でした。特に、ファイルとディレクトリでリンク数が異なる点や、inode との関係が前回よりも理解できるようになったような気がします。

次回は`nlink`の表示を Ruby で実装しますが、今回の観察がそのままロジックへの理解に繋がりそうです。まだ整理しきれていない部分もありますが、一つずつ確実に積み上げていきます。


---


### ⏰ 学習時間
- Today:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3 hours 24 min
- Total: 1483 hours 24 min
