# 2026/02/11(水)
## 📚 プラクティス『🛠️💻 lsコマンドを作る4』

<details><summary>🎯 学習の狙い</summary>

- 標準出力について学ぶ
- 標準ライブラリの使い方を学ぶ
- Enumeratorには、each以外にも便利なメソッドがあることを学ぶ
- RailsじゃないRubyプログラミングを学ぶ
- メソッド分割を学ぶ
- わかりやすい変数名・メソッド名を学ぶ
- 大きな問題を分割する力を学ぶ
</details>

<details><summary>📌 要件 ※ 随時、追加・変更あり</summary>

- [ ] `-l`オプションが指定された場合は、各ファイルについて「詳細情報（long format）」を一行ずつ表示すること
- [ ] `-l`オプションが指定されていない場合は、これまで通りファイル名のみを表示すること
- [ ] 表示する詳細情報は、以下の内容を含ませること
  - [ ] ファイルタイプ
  - [ ] ファイルモード
  - [ ] リンク数
  - [ ] 所有者
  - [ ] 所有グループ
  - [ ] サイズ
  - [ ] タイムスタンプ（更新日時）
  - [ ] ファイル名もしくはディレクトリ名
- [ ] `gem`は使わずに Ruby の標準ライブラリだけで作ること
- [ ] `rubocop-fjord`でデバッグを実行し、全てパスさせること
- [ ] 完成したコードは GitHub の Pull Request として提出すること

</details>

<details><summary>📍 処理の流れ ※ 随時、追加・変更あり</summary>

1. コマンドライン引数から`-l`オプションの有無を判定する

2. 対象のディレクトリのファイル一覧を配列として取得する

3. `-l`オプションが指定されていない場合 → これまで通り、ファイル名の配列をそのまま表示する

4. `-l`オプションが指定されている場合 → ①配列の各要素（各ファイル）について詳細情報を取得する / ②取得した複数の属性を一行の文字列に整形する

5. 整形済みの各行を上から順に標準出力へ表示させる
</details>

<details><summary> 🧩 タスクばらし ※ 随時、追加・変更あり</summary>

- [ ] タスク1：コマンドライン引数を解析し、`-l`オプションの有無を取得する
- [ ] タスク2：対象のディレクトリのファイル一覧を配列として取得する
- [ ] タスク3：「一つのファイルについて、どんな情報が取れるのか」を調べる
  - [x] ファイルタイプ
  - [x] ファイルモード
  - [x] リンク数
  - [ ] 所有者
  - [ ] 所有グループ
  - [ ] サイズ
  - [ ] タイムスタンプ（更新日時）
- [ ] タスク4：取得した「詳細情報（各属性）」を表示する
  - [ ] まずはバラバラに値を取り出せるようにする
- [ ] タスク5：複数の属性を整形して表示する
  - [ ] 横に並べて一行にする
- [ ] タスク6：タスク3〜5で行った処理を全てのファイルに対して適用する
  - [ ] まずは1ファイルで成功させる
  - [ ] 次に`each`で各ファイルに処理を適用させる
- [ ] タスク7：`-l`オプションが指定されていないときに、`ls`コマンドと同じ挙動になることを確認する
- [ ] タスク8：rubocop-fjord に通す
- [ ] タスク9：提出
  - [ ] 作成した lsコマンドを Pull Request として提出
  - [ ] 提出物に、`ls -l`コマンドの実行結果と、OS標準（macなど自分の使ってるOS）の`ls -l`コマンドの実行結果のスクリーンショットを併記して貼る
  - [ ] rubocop-fjord のチェックが全てパスした画面をスクショして添付
</details>


---


## 🧑🏻‍💻 本日の取り組み
### 📚 プラクティス『🛠️💻 lsコマンドを作る4』 
- `ls -l`の`nlink`の表示を Ruby で実装する

---


## ⏭️ 次回
### 📚 プラクティス『lsコマンドを作る4』
- 所有者ついて調べる


---


## 💡 本日の学び・気付き
### nlinkのコードの流れを押さえる
1. ファイル一覧を取得する
2. 各ファイルのリンク数を全て集める
3. 最大桁数を取得する
4. 右寄せで表示する

### STEP1：ファイル一覧を取得する
```ruby
files = Dir.children(".")
```
- `Dir.children`
→ 「そのフォルダの中のファイル名を全て取得」するメソッド。
- `.`
→ 「現在いるディレクトリ」を意味する。
- 戻り値はファイル名の文字列を並べた**配列**。
- その配列を変数`files`に代入。

### STEP2：各ファイルのリンク数を全て集める
```ruby
link_counts = files.map do |path|
  File.stat(path).nlink
end
```
- `map`
→ `map`は**配列の中身を一つずつ取り出して、新しい配列を作成する**メソッド。

例）
```ruby
[1, 2, 3].map { |n| n * 2 }
#=> [2, 4, 6]
```
今回の`map`メソッドでは、
- 変数`files`の各要素（ファイル名）を`path`として受け取る。
- `File.stat(path).nlink`で**リンク数**を取得する。
- 取得したリンク数を新しい配列にして変数`link_counts`に代入する。

例）
filesが
```shell
["file.txt", "link_to_file"]
```
なら、
```shell
link_counts = [2, 2]
```
（`file.txt`と`link_to_file`が同じファイルを参照するハードリンクの関係にある場合`nlink`はどちらも`2`になる）

### STEP3：右寄せするために「最大桁数」を求める
まず、リンク数（整数）を文字列に変換し、文字列の一覧を作成する。その中から最大値を取り出し、それを右寄せに使う幅として利用する。
```ruby
width = link_counts.map { |n| n.to_s.length }.max
```
- `n.to_s`
→ リンク数は**整数**なので、まず文字列に変える必要がある。
```ruby
2.to_s   #=> "2"
10.to_s   #=> "10"
```
- `length`
→ 文字列の長さを調べるメソッド。
```ruby
"2".length   #=> 1
"10".length #=> 2
```
- `map`で文字数の一覧を作成する
```ruby
link_counts.map { |n| n.to_s.length }
```
もし`link_counts`が`[2, 10, 1]`（各リンク数）なら
```shell
[1, 2, 1]
```
- `max`メソッドで最大値を取得する
```ruby
[1, 2, 1].max   #=> 2
```
→ これが**右寄せの幅**（**最大桁数**）になる。

### STEP4：最大桁数（width）を使って「整形表示」する
ここでは各ファイルのリンク数を取り出し、STEP3で求めた幅に合わせて右寄せで出力する。
```ruby
files.each do |path|
  nlink = File.stat(path).nlink
  puts nlink.to_s.rjust(width)
end
```
- `files.map`は取得した値を配列にしてまとめたが、`each`メソッドは**値を返さない**。あくまで「**順番に画面に出すため**」に使用する。
- `rjust(width)`
→ 文字列を**指定した幅で右寄せ**するメソッド。
```ruby
"2".rjust(2)    #=> " 2"
"10".rjust(2)   #=> "10"
```
左側にスペースが入る。

### 実行結果
今回は、各ファイルのリンク数が正しく取得できているかを確認するために、`File.stat(path).nlink`の結果をそのまま表示した。
```shell
~/stat_check % ruby stat_link_check.rb
2
2
2
1
2
2
3
2
1
1
7
```
リンク数が表示されていることを確認。


---


## ✍🏻 感想
### 🤔 『lsコマンドを作る1』と同じ概念で！
`nlink`の表示を Ruby で実装するにあたり、まず`nlink`の処理の流れを確認しました。ファイル一覧を取得する → 必要な情報（リンク数）を整形する......「あれ、これって『lsコマンドを作る1』のロジックを`nlink`に適用すればいいのでは？」と考えました。

一度このような考え方を経験していること、`map`メソッドと`each`メソッドの違いや`rjust`メソッド、`length`メソッドなどの Rubyメソッドの知識を記憶していたため、難しかったですが「何をどうすればよいのか」が理解できていました。

次回は所有者について取り組みます。


---


### ⏰ 学習時間
- Today:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 hours 00 min
- Total: 1487 hours 24 min
