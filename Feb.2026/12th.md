# 2026/02/12(木)
## 📚 プラクティス『🛠️💻 lsコマンドを作る4』

<details><summary>🎯 学習の狙い</summary>

- 標準出力について学ぶ
- 標準ライブラリの使い方を学ぶ
- Enumeratorには、each以外にも便利なメソッドがあることを学ぶ
- RailsじゃないRubyプログラミングを学ぶ
- メソッド分割を学ぶ
- わかりやすい変数名・メソッド名を学ぶ
- 大きな問題を分割する力を学ぶ
</details>

<details><summary>📌 要件 ※ 随時、追加・変更あり</summary>

- [ ] `-l`オプションが指定された場合は、各ファイルについて「詳細情報（long format）」を一行ずつ表示すること
- [ ] `-l`オプションが指定されていない場合は、これまで通りファイル名のみを表示すること
- [ ] 表示する詳細情報は、以下の内容を含ませること
  - [ ] ファイルタイプ
  - [ ] ファイルモード
  - [ ] リンク数
  - [ ] 所有者
  - [ ] 所有グループ
  - [ ] サイズ
  - [ ] タイムスタンプ（更新日時）
  - [ ] ファイル名もしくはディレクトリ名
- [ ] `gem`は使わずに Ruby の標準ライブラリだけで作ること
- [ ] `rubocop-fjord`でデバッグを実行し、全てパスさせること
- [ ] 完成したコードは GitHub の Pull Request として提出すること

</details>

<details><summary>📍 処理の流れ ※ 随時、追加・変更あり</summary>

1. コマンドライン引数から`-l`オプションの有無を判定する

2. 対象のディレクトリのファイル一覧を配列として取得する

3. `-l`オプションが指定されていない場合 → これまで通り、ファイル名の配列をそのまま表示する

4. `-l`オプションが指定されている場合 → ①配列の各要素（各ファイル）について詳細情報を取得する / ②取得した複数の属性を一行の文字列に整形する

5. 整形済みの各行を上から順に標準出力へ表示させる
</details>

<details><summary> 🧩 タスクばらし ※ 随時、追加・変更あり</summary>

- [ ] タスク1：コマンドライン引数を解析し、`-l`オプションの有無を取得する
- [ ] タスク2：対象のディレクトリのファイル一覧を配列として取得する
- [ ] タスク3：「一つのファイルについて、どんな情報が取れるのか」を調べる
  - [x] ファイルタイプ
  - [x] ファイルモード
  - [x] リンク数
  - [x] 所有者
  - [ ] 所有グループ
  - [ ] サイズ
  - [ ] タイムスタンプ（更新日時）
- [ ] タスク4：取得した「詳細情報（各属性）」を表示する
  - [ ] まずはバラバラに値を取り出せるようにする
- [ ] タスク5：複数の属性を整形して表示する
  - [ ] 横に並べて一行にする
- [ ] タスク6：タスク3〜5で行った処理を全てのファイルに対して適用する
  - [ ] まずは1ファイルで成功させる
  - [ ] 次に`each`で各ファイルに処理を適用させる
- [ ] タスク7：`-l`オプションが指定されていないときに、`ls`コマンドと同じ挙動になることを確認する
- [ ] タスク8：rubocop-fjord に通す
- [ ] タスク9：提出
  - [ ] 作成した lsコマンドを Pull Request として提出
  - [ ] 提出物に、`ls -l`コマンドの実行結果と、OS標準（macなど自分の使ってるOS）の`ls -l`コマンドの実行結果のスクリーンショットを併記して貼る
  - [ ] rubocop-fjord のチェックが全てパスした画面をスクショして添付
</details>


---


## 🧑🏻‍💻 本日の取り組み
### 📚 プラクティス『🛠️💻 lsコマンドを作る4』 
- 所有者について調べる


---


## ⏭️ 次回
### 📚 プラクティス『lsコマンドを作る4』
- 所有グループについて調べる


---


## 💡 本日の学び・気付き
### そもそも「所有者」とは？
`ls -l`コマンドの出力にある「このファイルを所有しているユーザー」を指す。OS の内部では、所有者は**名前ではなくUID**（**数値**）として記録されている。
例）
```shell
-rw-r--r--@ 2 yoshiwo  staff    0 Jan 22 05:38 file.txt
```
- `yoshiwo` → 所有者（owner）
- `staff` → グループ

### OSの中ではどう保存されている？
ファイルの`inode`に UID（整数）が記録されている。
例）
- yoshiwo → 501

こうした数値を Ruby の`File.stat`で取得できる。

#### Rubyで所有者を取得する
`File.stat`でファイルのメタ情報を取得し、`uid`メソッドで UID を取り出す。
```ruby
stat = File.stat('file.txt')
puts stat.uid
#=> 501
```
Ruby の`uid`メソッドは「数値（UID）」を返す。

### UIDを名前に変換するには？
そして、この「数値」を「名前」に変換するために`Etc.getpwuid(uid).name`という仕組みを使う。

Ruby の標準ライブラリの**Etcモジュール**は、「この UID の人の名前を教えて」と問い合わせる役割。
```ruby
require 'etc'

uid = File.stat('file.txt').uid
owner_name = Etc.getpwuid(uid).name

puts owner_name
#=> yoshiwo
```
処理の流れとして、
1. `File.stat`で UID（501）を取得。
2. `Etc.getpwuid(501)`でユーザー情報を取得。
3. `.name`で名前だけを取り出す。

#### 所有者を表示させる
作成したコード
```ruby
require 'etc'

files = Dir.children(".")

files.each do |path|
  uid = File.stat(path).uid
  owner = Etc.getpwuid(uid).name
  puts "#{path}: #{owner}"
end
```
`require 'etc'`
- Ruby の標準ライブラリの`Etc`を読み込む。
- `Etc`は OS のユーザー情報・グループ情報を扱うための**モジュール**。
- `uid`（数値）のままでは、誰なのか分からないため、`Etc.getpwuid(uid).name`を使用して**数値からユーザー名に変換**する必要がある。

`files = Dir.children(".")`
- カレントディレクトリ`.`のファイル一覧を配列で取得する。
- `Dir.children`は`.`や`..`を含まないファイル名を返すため。

`files.each do |path|`
- 取得したファイル一覧（配列）を**一つずつ取り出して繰り返す**。
- `path`には`file.txt`のような**ファイル名**（**相対パス**）が入る。

`uid = File.stat(path).uid`
- `File.stat(path)`
→ ファイルのメタ情報を取得。
- `uid`
→ 所有者の UID（数値）を取得。

`owner = Etc.getpwuid(uid).name`
- `Etc.getpwuid(uid)`
→ UID からユーザー情報を取り出す。
- `name`
→ ユーザーのログイン名（文字列）を取得。

`puts "#{path}: #{owner}"`
- 確認のため、ファイル名とその所有者の名前を整形して画面に出力させる。

### 実行結果
```shell
~/stat_check % ruby stat_owner_check.rb
file.txt: yoshiwo
nlink_file_link.txt: yoshiwo
link_to_file: yoshiwo
stat_owner_check.rb: yoshiwo
stat_type_check.rb: yoshiwo
nlink_file.txt: yoshiwo
new_link: yoshiwo
dir_for_nlink: yoshiwo
test_dir: yoshiwo
stat_perm_check.rb: yoshiwo
stat_link_check.rb: yoshiwo
.idea: yoshiwo
```
ファイル名とその所有者名が表示されている。

### 🔗 参照リンク
- [Method: File::Stat#uid](https://www.rubydoc.info/stdlib/core/2.1.6/File%2FStat:uid)
- [Find out the name of a user, on a given file/dir/symlink?](https://rubytalk.org/t/find-out-the-name-of-a-user-on-a-given-file-dir-symlink/53820?utm_source=chatgpt.com)
- [module Etc](https://docs.ruby-lang.org/ja/latest/class/Etc.html?utm_source=chatgpt.com)


---


## ✍🏻 感想
### 🧑🏻‍💻 同じパターンで理解できた
所有者の取得も、「`File.stat` → 必要な情報を抜き出す → 人が読める形へ整形」という`nlink`と同じ処理パターンでできました。

どうやら`ls -l`コマンドの項目はこの流れで取得できるものが多いと分かり、全体像が掴めてきました🤔

一方で、Rubyリファレンスマニュアルを読み解く力がまだ十分ではなく、二次情報に頼る場面が多々ありました。このあたりは今後の改善ポイントだと感じています。

Rubyリファレンスマニュアルともっと仲良くなれる余地があると前向きに受け止めていきましょう！


---


### ⏰ 学習時間
- Today:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 hours 54 min
- Total: 1489 hours 18 min
