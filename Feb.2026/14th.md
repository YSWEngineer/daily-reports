# 2026/02/14(土)
## 📚 プラクティス『🛠️💻 lsコマンドを作る4』

<details><summary>🎯 学習の狙い</summary>

- 標準出力について学ぶ
- 標準ライブラリの使い方を学ぶ
- Enumeratorには、each以外にも便利なメソッドがあることを学ぶ
- RailsじゃないRubyプログラミングを学ぶ
- メソッド分割を学ぶ
- わかりやすい変数名・メソッド名を学ぶ
- 大きな問題を分割する力を学ぶ
</details>

<details><summary>📌 要件 ※ 随時、追加・変更あり</summary>

- [ ] `-l`オプションが指定された場合は、各ファイルについて「詳細情報（long format）」を一行ずつ表示すること
- [ ] `-l`オプションが指定されていない場合は、これまで通りファイル名のみを表示すること
- [ ] 表示する詳細情報は、以下の内容を含ませること
  - [ ] ファイルタイプ
  - [ ] ファイルモード
  - [ ] リンク数
  - [ ] 所有者
  - [ ] 所有グループ
  - [ ] サイズ
  - [ ] タイムスタンプ（更新日時）
  - [ ] ファイル名もしくはディレクトリ名
- [ ] `gem`は使わずに Ruby の標準ライブラリだけで作ること
- [ ] `rubocop-fjord`でデバッグを実行し、全てパスさせること
- [ ] 完成したコードは GitHub の Pull Request として提出すること

</details>

<details><summary>📍 処理の流れ ※ 随時、追加・変更あり</summary>

1. コマンドライン引数から`-l`オプションの有無を判定する

2. 対象のディレクトリのファイル一覧を配列として取得する

3. `-l`オプションが指定されていない場合 → これまで通り、ファイル名の配列をそのまま表示する

4. `-l`オプションが指定されている場合 → ①配列の各要素（各ファイル）について詳細情報を取得する / ②取得した複数の属性を一行の文字列に整形する

5. 整形済みの各行を上から順に標準出力へ表示させる
</details>

<details><summary> 🧩 タスクばらし ※ 随時、追加・変更あり</summary>

- [x] タスク1：コマンドライン引数を解析し、`-l`オプションの有無を取得する
- [x] タスク2：対象のディレクトリのファイル一覧を配列として取得する
- [x] タスク3：「一つのファイルについて、どんな情報が取れるのか」を調べる
  - [x] ファイルタイプ
  - [x] ファイルモード
  - [x] リンク数
  - [x] 所有者
  - [x] 所有グループ
  - [x] サイズ
  - [x] タイムスタンプ（更新日時）
- [x] タスク4：取得した「詳細情報（各属性）」を表示する
  - [x] まずはバラバラに値を取り出せるようにする
- [ ] タスク5：複数の属性を整形して表示する
  - [ ] 横に並べて一行にする
- [ ] タスク6：タスク3〜5で行った処理を全てのファイルに対して適用する
  - [ ] まずは1ファイルで成功させる
  - [ ] 次に`each`で各ファイルに処理を適用させる
- [ ] タスク7：`-l`オプションが指定されていないときに、`ls`コマンドと同じ挙動になることを確認する
- [ ] タスク8：rubocop-fjord に通す
- [ ] タスク9：提出
  - [ ] 作成した lsコマンドを Pull Request として提出
  - [ ] 提出物に、`ls -l`コマンドの実行結果と、OS標準（macなど自分の使ってるOS）の`ls -l`コマンドの実行結果のスクリーンショットを併記して貼る
  - [ ] rubocop-fjord のチェックが全てパスした画面をスクショして添付
</details>


---


## 🧑🏻‍💻 本日の取り組み
### 📚 プラクティス『🛠️💻 lsコマンドを作る4』 
- 所有グループの取得と表示
- サイズの取得と表示
- タイムスタンプの取得と表示


---


## ⏭️ 次回
### 📚 プラクティス『lsコマンドを作る4』
- タイムスタンプを右寄せに整形する


---


## 💡 本日の学び・気付き
### 所有グループの取得と表示
#### グループ（gid）とは？
Linux や UNIX では、ユーザーは一つ以上のグループに属している。
- 開発チームなら`dev`
- 共通グループなら`staff`

のようなイメージ。
そしてファイルはたった一つだけグループを持つ。
例）
```shell
-rw-r--r--@ 2 yoshiwo  staff    0 Jan 22 05:38 file.txt
```
この`staff`が`gid`。

#### gidはどう取得する？
Ruby の`File::Stat`に`gid`が入っている。
```ruby
stat = File.stat('ファイル名')
stat.gid   # 数値が返る
```
しかし、`ls -l`コマンドでは名前（例：`staff`）を表示する。
変換には前回の所有者（uid → 名前）と同じく`Etc`モジュールを使用する。

#### gid → グループ名への変換
```ruby
require 'etc'

gid = File.stat('file.txt').gid
group = Etc.getgrgid(gid).name
```
- `require 'etc'`
→ モジュール`Etc`を使用できるように設定。
- `Etc.getgrgid(gid)`
→ グループ情報を取得。
- `.name`
→ （取得したグループ情報を）名前に変換。

#### 所有グループを表示させる
作成したコード
```ruby
require 'etc'

files = Dir.children(".")

files.each do |path|
  gid = File.stat(path).gid
  group = Etc.getgrgid(gid).name
  puts "#{path}: #{group}"
end

# 実行結果
~/stat_check % ruby stat_group_check.rb
file.txt: staff
nlink_file_link.txt: staff
stat_group_check.rb: staff
link_to_file: staff
stat_owner_check.rb: staff
stat_type_check.rb: staff
nlink_file.txt: staff
new_link: staff
dir_for_nlink: staff
test_dir: staff
stat_perm_check.rb: staff
stat_link_check.rb: staff
.idea: staff
```
構造はすでに学んだ「所有者（`uid`）」と全く同じ。
違うのは、
- `uid` → `gid`
- `getpwuid` → `getgrgid`

の2点だけ。

#### まとめ
- `gid`は所有グループを表す数値
- 実際の表示には`グループ名`を使用する
- Ruby では`Etc.getgrgid(gid).name`で数値を取得 → 数値を名前に変換

---
### サイズ（ファイルサイズ）の取得と表示
#### ファイルサイズとは何か？
ファイルサイズとは、**ファイルに格納されているデータ量をバイト（Byte）単位で表したもの**。
例）
- 空きファイル → 0 Byte
- テキスト1文字 → およそ 1 Byte
- 1000文字 → 約 1 KB（= 1024 Byte）

というように、ファイルがどれだけのデータを持っているかを表す数値。
例）
```shell
-rw-r--r--@ 2 yoshiwo  staff    0 Jan 22 05:38 file.txt
```
`0`がファイルの Byteサイズ。つまり、`file.txt`ファイルは 0 Byte だと分かる。

#### ファイルサイズを取得する方法
Ruby の`File::Stat`に`size`が入っている。
```ruby
File.stat(ファイルパス).size
```
例）
```ruby
stat = File.stat('file.txt')
puts stat.size
```

#### 右寄せに整形して表示
作成したコード
```ruby
files = Dir.children(".")

sizes = files.map { |path| File.stat(path).size }

width = sizes.map { |s| s.to_s.length }.max

files.each do |path|
  size = File.stat(path).size
  puts size.to_s.rjust(width)
end

# 実行結果
~/stat_check % ruby stat_size_check.rb
  0
  6
241
  0
256
313
263
  6
  0
 96
 64
495
404
224
```
数値なので右寄せにして読みやすく整形を行う。これは`nlink`の処理と同じ方法。数値が桁揃えされていないと、`ls -l`コマンドのような表形式が崩れて読みづらくなるため右寄せで整形する。

#### まとめ
- `size`はファイルが実際に占めているバイト数（整数）
- `File.stat(path).size`で取得する
- `ls -l`コマンドと同じように整形するため、右寄せで
- 実装の流れ
  1. `files`を取得
  2. `size`を全て集める
  3. 最大幅（`width`）を計算
  4. `size.to_s.rjust(width)`で右寄せで表示

---

### タイムスタンプ（更新日時）の取得と表示
#### タイムスタンプとは？
`ls -l`コマンドでは、次のような形で日付が表示される。
```shell
Feb 14 13:32
```
これがファイルの「更新日時（`mtime`）」。

#### 3種類のタイムスタンプ
Rubyリファレンスマニュアルを見ると、3種類のタイムスタンプを確認できた。
1. `atime` → 最終アクセス時刻
2. `mtime` → 最終更新時刻
3. `ctime` → 最終状態変更時刻（inodeを変更した時刻）

`ls -l`コマンドで使用しているのは`mtime`。
```ruby
File.stat(path).mtime
```

#### mtimeの取得
```ruby
mtime = File.stat("file.txt").mtime
puts mtime

# 実行結果
~/stat_check % ruby stat_mtime_check.rb 
2026-01-22 05:38:41 +0900
```

#### ls -lコマンドの形に整形する
`mtime`メソッドで取得した内容を`strftime`メソッドで整形する。`strftime`は日時オブジェクトを指定したフォーマットの文字列に変換するメソッド。

フォーマットを確認すると、**①月の省略名 ②日付 ③24時間表記 ④分** の順に表示されている。
```ruby
mtime = File.stat("file.txt").mtime
puts mtime.strftime("%b %e %H:%M")

# 実行結果
~/stat_check % ruby stat_mtime_check.rb
Jan 22 05:38
```
表示が変わっていることを確認。

作成したコード（とりあえず表示のみ）
```ruby
files = Dir.children(".")

files.each do |path|
  mtime = File.stat(path).mtime.strftime("%b %e %H:%M")
  puts "#{path}: #{mtime}"
end

# 実行結果
~/stat_check % ruby stat_mtime_check.rb
file.txt: Jan 22 05:38
nlink_file_link.txt: Feb 10 17:33
stat_group_check.rb: Feb 14 13:32
link_to_file: Jan 22 05:38
stat_size_check.rb: Feb 14 14:58
stat_owner_check.rb: Feb 12 20:38
stat_type_check.rb: Jan 22 05:36
nlink_file.txt: Feb 10 17:33
new_link: Jan 22 05:38
dir_for_nlink: Feb 10 20:23
test_dir: Jan 22 05:38
stat_perm_check.rb: Feb  2 18:39
stat_link_check.rb: Feb 11 15:11
stat_mtime_check.rb: Feb 14 15:47
.idea: Feb 14 15:43
```
各ファイルに対してタイムスタンプが表示されているのを確認。

#### まとめ
- `mtime`はファイルが最後に更新された時刻を表す
- `ls -l`コマンドで表示される日付はこの`mtime`
- `ls -l`コマンドと同じ表示にするには`strftime`を使用する
- 実装の流れ
  1. `files`を取得
  2. 各ファイルの`mtime`を取得
  3. `strftime`で指定した形に整える


---


## ✍🏻 感想
### 🐾 一歩ずつ着実に
所有グループ・サイズ・タイムスタンプの取得と表示までできました。次回はタイムスタンプの表示を`ls -l`コマンドと同じになるように整えていきます。一つ一つ仕様を確認しながら進められているので、この調子で続けていきます。


---


### ⏰ 学習時間
- Today:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3 hours 04 min
- Total: 1492 hours 22 min
