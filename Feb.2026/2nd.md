# 2026/02/02(月)
## 📚 プラクティス『🛠️💻 lsコマンドを作る4』

<details><summary>🎯 学習の狙い</summary>

- 標準出力について学ぶ
- 標準ライブラリの使い方を学ぶ
- Enumeratorには、each以外にも便利なメソッドがあることを学ぶ
- RailsじゃないRubyプログラミングを学ぶ
- メソッド分割を学ぶ
- わかりやすい変数名・メソッド名を学ぶ
- 大きな問題を分割する力を学ぶ
</details>

<details><summary>📌 要件 ※ 随時、追加・変更あり</summary>

- [ ] `-l`オプションが指定された場合は、各ファイルについて「詳細情報（long format）」を一行ずつ表示すること
- [ ] `-l`オプションが指定されていない場合は、これまで通りファイル名のみを表示すること
- [ ] 表示する詳細情報は、以下の内容を含ませること
  - [ ] ファイルタイプ
  - [ ] ファイルモード
  - [ ] リンク数
  - [ ] 所有者
  - [ ] 所有グループ
  - [ ] サイズ
  - [ ] タイムスタンプ（更新日時）
  - [ ] ファイル名もしくはディレクトリ名
- [ ] `gem`は使わずに Ruby の標準ライブラリだけで作ること
- [ ] `rubocop-fjord`でデバッグを実行し、全てパスさせること
- [ ] 完成したコードは GitHub の Pull Request として提出すること

</details>

<details><summary>📍 処理の流れ ※ 随時、追加・変更あり</summary>

1. コマンドライン引数から`-l`オプションの有無を判定する

2. 対象のディレクトリのファイル一覧を配列として取得する

3. `-l`オプションが指定されていない場合 → これまで通り、ファイル名の配列をそのまま表示する

4. `-l`オプションが指定されている場合 → ①配列の各要素（各ファイル）について詳細情報を取得する / ②取得した複数の属性を一行の文字列に整形する

5. 整形済みの各行を上から順に標準出力へ表示させる
</details>

<details><summary> 🧩 タスクばらし ※ 随時、追加・変更あり</summary>

- [ ] タスク1：コマンドライン引数を解析し、`-l`オプションの有無を取得する
- [ ] タスク2：対象のディレクトリのファイル一覧を配列として取得する
- [ ] タスク3：「一つのファイルについて、どんな情報が取れるのか」を調べる
  - [x] ファイルタイプ
  - [x] ファイルモード
  - [ ] リンク数
  - [ ] 所有者
  - [ ] 所有グループ
  - [ ] サイズ
  - [ ] タイムスタンプ（更新日時）
- [ ] タスク4：取得した「詳細情報（各属性）」を表示する
  - [ ] 先ずはバラバラに値を取り出せるようにする
- [ ] タスク5：複数の属性を整形して表示する
  - [ ] 横に並べて一行にする
- [ ] タスク6：タスク3〜5で行った処理を全てのファイルに対して適用する
  - [ ] 先ずは1ファイルで成功させる
  - [ ] 次に`each`で各ファイルに処理を適用させる
- [ ] タスク7：`-l`オプションが指定されていないときに、`ls`コマンドと同じ挙動になることを確認する
- [ ] タスク8：rubocop-fjord に通す
- [ ] タスク9：提出
  - [ ] 作成した lsコマンドを Pull Request として提出
  - [ ] 提出物に、`ls -l`コマンドの実行結果と、OS標準（macなど自分の使ってるOS）の`ls -l`コマンドの実行結果のスクリーンショットを併記して貼る
  - [ ] rubocop-fjord のチェックが全てパスした画面をスクショして添付
</details>


---


## 🧑🏻‍💻 本日の取り組み
### 📚 プラクティス『🛠️💻 lsコマンドを作る4』 
- ファイルモードについて調べる
- ファイルモードを判定するコードを作成


---


## ⏭️ 次回
### 📚 プラクティス『lsコマンドを作る4』
- リンク数について調べる
- リンク数を判定するコードを作成


---


### 💡 本日の学び・気付き
#### modeメソッドについて理解する
##### 1. modeとは何か？
`mode`は一言で言うと、「ファイルが持つ『**権限（パーミッション）**』と『**種類**』を1つの数値として保持しているデータ」のこと。

人間が見ると、
```shell
-rw-r--r--
```
しかし、コンピュータの中では、
```shell
33188
```
のような数字の羅列で管理されている。`mode`メソッドは、その「コンピュータ専用のデータ」をそのまま返すメソッド。

##### 2. mode の数値がどうパーミッションに変換されるのか？（変換の流れ）
例えば`mode = 33188`の場合、Ruby では次の処理が起きる。
```shell
33188 (10進数)
↓ to_s(8) で8進数へ変換
100644
↓ 後ろ3桁が権限（パーミッション）を表す
644
↓ 対応表で変換
rw-r--r--
```
この「**644 → rw-r--r--**」の変換が、パーミッションの中核となる。
ファイルのパーミッションが数字から「rwx の記号」に変換される仕組みはここにある。

##### 3. 最小コードで mode → perm の流れを確認する
先ずは`mode`がどう変換されるかを確認する。
```ruby
file = 'file.txt'
mode = File.stat(file).mode
perm = mode.to_s(8)[-3, 3]

puts "mode(数値) = #{mode}"
puts "8進数表示 = #{mode.to_s(8)}"
puts "権限3桁 = #{perm}"
```
```shell
# 実行結果
~/stat_check % ruby stat_perm_check.rb
mode(数値) = 33188
8進数表示 = 100644
権限3桁 = 644
```
ここまでで、
- `33188`の意味
- `100644`の構造
- パーミッションは後ろ3桁は「`644`」

だと、把握できる。

##### 4. パーミッションを「rwx形式」に変換するメソッド
数値`644`を、人間に読みやすい`rw-r--r--`に変換する仕組みは次のメソッドで可能になる。
```ruby
# パーミッションの数値を記号に変換する
def permission_string(mode)
  # 8進数に変換し、後ろ3桁（パーミッション）を取り出す
  perm = mode.to_s(8)[-3, 3]

  # rwxの対応表（テーブル）
  table = {
    '0' => '---',
    '1' => '--x',
    '2' => '-w-',
    '3' => '-wx',
    '4' => 'r--',
    '5' => 'r-x',
    '6' => 'rw-',
    '7' => 'rwx',
  }

  # 644 → ["6", "4", "4"] → ["rw-", "r--", "r--"] → "rw-r--r--"と変換
  perm.chars.map { |n| table[n] }.join
end
```
###### コードの処理を言語化
① `perm = stat.mode.to_s(8)[-3, 3]`
- `mode`を8進数にする（例：100644）
- 後ろ3桁だけを取り出す（644）

② `perm.chars`
- `"644"`→`["6", "4", "4"]`

③ `map { |n| table[n] }`
- `"6"`→`"rw-"`
- `"4"`→`"r--"`
- `"4"`→`"r--"`

④ `join`
- 一つの文字列に繋げ`"rw-r--r--"`となる

##### 5. permission_string が正しく動くか最小コードで確認する
```ruby
def permission_string(mode)
  perm = mode.to_s(8)[-3, 3]
  table = {
    '0' => '---',
    '1' => '--x',
    '2' => '-w-',
    '3' => '-wx',
    '4' => 'r--',
    '5' => 'r-x',
    '6' => 'rw-',
    '7' => 'rwx',
  }
  perm.chars.map { |n| table[n] }.join
end

stat = File.stat('file.txt')
puts permission_string(stat.mode)
```
```shell
# 実行結果
~/stat_check % ruby stat_perm_check.rb
rw-r--r--
```
正しくパーミッションが変換されていることを確認。


---


## ✍🏻 感想
### 🤔 難しいけど、面白い！
パーミッションを表示するためのパーツを一つずつ作成しました。作業を進めながら、「`-l`オプションに必要な各処理を最終的にどうまとめて全体として動く形に仕上げればいいのだろう？」と考える瞬間がありますが、まだイメージははっきり掴めていません。

それでも、ファイルタイプ → ファイルモード（パーミッション）と順に理解が深まっていく感覚があり、少しずつ全体像が見えてきました。難しさはありますが、その中に確かな面白さも感じています。

次回はリンク数に取り組みます。


---


### ⏰ 学習時間
- Today:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 hours 55 min
- Total: 1478 hours 22 min
