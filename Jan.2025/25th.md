# 2025/01/25(土)
## 📚 プラクティス『Ruby中級』


## 🧩 タスクばらし
- [x] プラクティスの内容を咀嚼
- [x] タスクばらし、スモールステップの作成
- [x] 各参考ページを確認
- [ ] 参考書籍：[プロを目指す人のためのRuby入門 <改訂2版>](https://www.amazon.co.jp/dp/4297124378/)を読んで、実際に手を動かしてツールを使ってみてコードを書いてみる


## 🐾 スモールステップ
<details><summary>プラクティスの内容を咀嚼</summary>

- [x] プラクティスの内容を咀嚼
</details>

<details><summary>タスクばらし、スモールステップの作成</summary>

- [x] タスクばらし、スモールステップの作成
</details>

<details><summary>各参考ページを確認</summary>

- [x] [学習を加速させるインデックス読書術](https://qiita.com/dkatsura/items/3364b293ed1451a66a8a)を再読
- [x] 動画：[著者自身が語る「プロを目指す人のためのRuby入門」の効果的な読み方](https://www.youtube.com/watch?v=qqqbHXarPO8)
</details>

<details><summary>参考書籍：プロを目指す人のためのRuby入門 <改訂2版>を読んで、実際に手を動かしてツールを使ってみてコードを書いてみる</summary>

- [x] 第1章  本書を読み進める前に
   - [x] 1.1 イントロダクション
   - [x] 1.2 本書の概要
   - [x] 1.3 Ruby について
   - [x] 1.4 Ruby のインストール
   - [x] 1.5 エディタ/IDE について
   - [x] 1.6 Ruby を動かしてみる
   - [x] 1.7 本書のサンプルコードについて
   - [x] 1.8 Ruby の公式リファレンスについて
   - [x] 1.9 この章のまとめ
- [x] 第2章  Ruby の基礎を理解する
   - [x] 2.1 イントロダクション
   - [x] 2.2 Ruby に関する基礎知識
   - [x] 2.3 文字列
   - [x] 2.4 数値
   - [x] 2.5 真偽値と条件分岐
   - [x] 2.6 メソッドの定義
   - [x] 2.7 例題：FizzBuzzプログラムを作成する
   - [x] 2.8 文字列についてもっと詳しく
   - [x] 2.9 数値についてもっと詳しく
   - [x] 2.10 真偽値と条件分岐についてもっと詳しく
   - [x] 2.11 メソッド定義についてもっと詳しく
   - [x] 2.12 そのほかの基礎知識
   - [x] 2.13 この章のまとめ
- [x] 第3章  テストを自動化する
   - [x] 3.1 イントロダクション
   - [x] 3.2 Minitest の基本
   - [x] 3.3 FizzBuzzプログラムのテスト自動化
   - [x] 3.4 この章のまとめ
- [x] 第4章  配列や繰り返し処理を理解する
   - [x] 4.1 イントロダクション
   - [x] 4.2 配列
   - [x] 4.3 ブロック
   - [x] 4.4 ブロックを使う配列のメソッド
   - [x] 4.5 範囲（Range）
   - [x] 4.6 例題：RGB変換プログラムを作成する
   - [x] 4.7 配列についてもっと詳しく
   - [x] 4.8 ブロックについてもっと詳しく
   - [x] 4.9 範囲（Range）についてもっと詳しく
   - [x] 4.10 さまざまな繰り返し処理
   - [x] 4.11 繰り返し処理用の制御構造
   - [x] 4.12 この章のまとめ
- [ ] 第5章  ハッシュやシンボルを理解する
   - [x] 5.1 イントロダクション
   - [x] 5.2 ハッシュ
   - [x] 5.3 シンボル
   - [x] 5.4 続・ハッシュについて
   - [x] 5.5 例題：長さの単位交換プログラムを作成する
   - [ ] 5.6 ハッシュとキーワード引数についてもっと詳しく
   - [ ] 5.7 シンボルについてもっと詳しく
   - [ ] 5.8 この章のまとめ
- [ ] 第6章  正規表現を理解する
   - [ ] 6.1 イントロダクション
   - [ ] 6.2 正規表現って何？
   - [ ] 6.3 Ruby における正規表現オブジェクト
   - [ ] 6.4 例題：Ruby のハッシュ記法を変換する
   - [ ] 6.5 正規表現オブジェクトについてもっと詳しく
   - [ ] 6.6 この章のまとめ
- [ ] 第7章  クラスの作成を理解する
   - [ ] 7.1 イントロダクション
   - [ ] 7.2 オブジェクト指向プログラミングの基礎知識
   - [ ] 7.3 クラスの定義
   - [ ] 7.4 例題：改札機プログラムの作成
   - [ ] 7.5 selfキーワード
   - [ ] 7.6 クラスの継承
   - [ ] 7.7 メソッドの可視性
   - [ ] 7.8 定数についてもっと詳しく
   - [ ] 7.9 さまざまな種類の変数
   - [ ] 7.10 クラス定義や Ruby の言語使用に関する高度な話題
   - [ ] 7.11 この章のまとめ
- [ ] 第8章  モジュールを理解する
   - [ ] 8.1 イントロダクション
   - [ ] 8.2 モジュールの概要
   - [ ] 8.3 モジュールを利用したメソッド定義（include と extend）
   - [ ] 8.4 例題：rainbowメソッドの作成
   - [ ] 8.5 モジュールを利用したメソッド定義についてもっと詳しく
   - [ ] 8.6 モジュールを利用した名前空間の作成
   - [ ] 8.7 関数や定数を提供するモジュールの作成
   - [ ] 8.8 状態を保持するモジュールの作成
   - [ ] 8.9 モジュールに関する高度な話題
   - [ ] 8.10 この章のまとめ
- [ ] 第9章  例外処理を理解する
   - [ ] 9.1 イントロダクション
   - [ ] 9.2 例外の捕捉
   - [ ] 9.3 意図的に例外を発生させる
   - [ ] 9.4 例外処理のベストプラクティス
   - [ ] 9.5 例題：正規表現チェッカープログラムの作成
   - [ ] 9.6 例外処理についてもっと詳しく
   - [ ] 9.7 この章のまとめ
- [ ] 第10章  yield と Proc を理解する
   - [ ] 10.1 イントロダクション
   - [ ] 10.2 ブロックを利用するメソッドの定義と yield
   - [ ] 10.3 Procオブジェクト
   - [ ] 10.4 例題：ワードシンセサイザーの作成
   - [ ] 10.5 Procオブジェクトについてもっと詳しく
   - [ ] 10.6 この章のまとめ
- [ ] 第11章  パターンマッチを理解する
   - [ ] 11.1 イントロダクション
   - [ ] 11.2 パターンマッチの基本
   - [ ] 11.3 パターンマッチの利用パターン
   - [ ] 11.4 例題：ログフォーマッターの作成
   - [ ] 11.5 パターンマッチについてもっと詳しく
   - [ ] 11.6 この章のまとめ
- [ ] 第12章  Ruby のデバッグ技法を身につける
   - [ ] 12.1 イントロダクション
   - [ ] 12.2 バックトレースの読み方
   - [ ] 12.3 よく発生する例外クラスとその原因
   - [ ] 12.4 プログラムの途中経過を確認する
   - [ ] 12.5 汎用的なトラブルシューティング方法
   - [ ] 12.6 この章のまとめ
- [ ] 第13章  Ruby に関するその他のトピック
   - [ ] 13.1 イントロダクション
   - [ ] 13.2 日付や時刻の扱い
   - [ ] 13.3 ファイルやディレクトリの扱い
   - [ ] 13.4 特定の形式のファイルを読み書きする
   - [ ] 13.5 環境変数や起動時引数の取得
   - [ ] 13.6 非推奨機能を使ったときに警告を出力する
   - [ ] 13.7 eval、バッククオートリテラル、sendメソッド
   - [ ] 13.8 Rake
   - [ ] 13.9 gem と Bundler
   - [ ] 13.10 Ruby における型情報の定義と型検査（RBS、TypeProf、Steep）
   - [ ] 13.11 「Rails の中の Ruby」と「素の Ruby」の違い
   - [ ] 13.12 この章のまとめ

</details>


------------


## 🧑🏻‍💻 本日の取り組み
### プラクティス『Ruby中級』
- 参考書籍：『プロを目指す人のためのRuby入門 <改訂2版>』を読み進める
  - 第5章  ハッシュやシンボルを理解する
    - 5.4 続・ハッシュについて
    - 5.5 例題：長さの単位交換プログラムを作成する


## 🎯 次回
### プラクティス『Ruby中級』
- 参考書籍：『プロを目指す人のためのRuby入門 <改訂2版>』を読み進める
  - 第5章  ハッシュやシンボルを理解する
    - 5.6 ハッシュとキーワード引数についてもっと詳しく


------------


## 💡 本日の学び・気付き
### 5.4 続・ハッシュについて
#### ハッシュのキーにシンボルを使う
設計上、文字列でもシンボルでもどちらでも良いのならハッシュのキーには文字列よりもシンボルのほうが適している。ハッシュのキーにシンボルを使うと以下のようなコードになる。
```ruby
# ハッシュのキーをシンボルにする
currencies = { :japan => 'yen', :us => 'dollar', :india => 'rupee' }
# シンボルを使って値を取り出す
irb(main):131> currencies[:us]
=> "dollar"

# 新しいキーと値の組み合わせを追加する
currencies[:italy] = 'euro'
```
シンボルがキーになる場合、`=>`を使わずに**シンボル: 値**という記法でハッシュを作成できる。このとき、**コロンの位置が左から右に変わる**点に注意。
```ruby
# =>ではなく、"シンボル: 値"の記法でハッシュを作成する
currencies = { japan: 'yen', us: 'dollar', india: 'rupee' }
# 値を取り出すときは同じ
currencies[:us]
```
キーも値もシンボルの場合は次のようになる。
```ruby
{ japan: :yen, us: :dollar, india: :rupee }
```
上記のハッシュは、下記のハッシュと全く同じ。
```ruby
{ :japan => :yen, :us => :dollar, :india => :rupee }
```

#### キーや値に異なるデータ型を混在させる
ハッシュのキーは同じデータ型にする必要はない。たとえば、文字列とシンボルを混在させることもできる。しかし、必要がない限りデータ型は揃えたほうが良い。
```ruby
# 文字列のキーとシンボルのキーを混在させる（良いコードではないので注意）
hash = { 'abc' => 123, def: 456 }

# 値を取得する場合はデータ型を合わせてキーを指定する
irb(main):137> hash['abc']
=> 123
irb(main):138> hash[:def]
=> 456

# データ型が異なると値は取得できない
irb(main):139> hash[:abc]
=> nil
irb(main):140> hash['def']
=> nil
```
一方、ハッシュに格納する値に関しては、異なるデータ型が混在するケースもよくある。
```ruby
person = {
  # 値が文字列
  name: 'Alice',
  # 値が数値
  age: 20,
  # 値が配列
  friends: ['Bob', 'Carol'],
  # 値がハッシュ
  phones: { home: '1234-0000', mobile: '5678-0000' }
}

irb(main):147> person[:age]
=> 20
irb(main):148> person[:friends]
=> ["Bob", "Carol"]
irb(main):149> person[:phones][:mobile]
=> "5678-0000"
```

#### メソッドのキーワード引数とハッシュ
Ruby には「キーワード引数」という機能がある。キーワード引数を使うと、**メソッド呼び出し時にどの引数がどんな意味を持つのか対応関係がわかりやすく**なる。たとえば、以下に架空のメソッドがあったとする。
```ruby
def buy_burger(menu, drink, potato)
  # ハンバーガーを購入
  if drink
    # ドリンクを購入
  end
  if potato
    # ポテトを購入
  end
end

# チーズバーガーとドリンクとポテトを購入する
buy_burger('cheese', true, true)

# フィッシュバーガーとドリンクを購入する
buy_burger('fish', true, false)
```
説明もなく以下のコードを見せられたらどうなるか？
```ruby
buy_burger('cheese', true, true)
buy_burger('fish', true, false)
```
↑こういうケースでは**メソッドのキーワード引き痛を使うと可読性が上がる**。メソッドのキーワード引数は次のように定義する。
```ruby
def メソッド名(キーワード引数1: デフォルト値1, キーワード引数2: デフォルト値2)
  # メソッドの実装
end
```
`buy_burger`メソッドでキーワード引数を使うと次のようになる。
```ruby
def buy_burger(menu, drink: true, potato: true)
  # 省略
end
```
キーワード引数を持つメソッドを呼び出す場合は、キーがシンボルのハッシュを作る時と同じように、**引数名: 値**の形式で引数を指定する。
```ruby
buy_burger('cheese', drink: true, potato: true)
buy_burger('fish', drink: true, potato: false)
```
キーワード引数にはデフォルト値が設定されているため、引数を省略することもできる。
```ruby
# drinkはデフォルト値のtrueを使うので指定しない
buy_burger('fish', potato: false)

# drinkもpotatoもデフォルト値のtrueを使うので指定しない
buy_burger('cheese')
```
キーワード引数は呼び出し時に自由に順番を入れ替えることができる。
```ruby
buy_burger('fish', potato: false, drink: true)
```
存在しないキーワード引数を指定した場合はエラーになる。
```ruby
irb(main):165> buy_burger('fish', salad: true)
unknown keyword: :salad (ArgumentError)
```
キーワード引数のデフォルト値は省略することもできる。デフォルト値を持たないキーワード引数は、呼び出し時に省略することができない。
```ruby
# デフォルト値なしのキーワード引数を使ってメソッドを定義する
def buy_burger(menu, drink:, potato:)
  if drink
  end
  if potato
  end
end

# キーワード引数を指定すれば、デフォルト値ありの場合と同じように使える
buy_burger('cheese', drink: true, potato: true)

# キーワード引数を省略するとエラーになる
irb(main):173> buy_burger('fish', potato: false)
missing keyword: :drink (ArgumentError)
```
キーワード引数を使うメソッドを呼び出す場合、`**`を手前に付けることでハッシュをキーワード引数として渡すこともできる。
```ruby
params = { drink: true, potato: false }
# **を付けてハッシュをキーワード引数として利用する
buy_burger('fish', **params)
```

### 5.5 例題：長さの単位変換プログラムを作成する
#### テストコードを準備する
testディレクトリに**convert_length_test.rb**ファイルを作成する。作成したファイルに以下のコードを書く。
```ruby
require 'minitest/autorun'

class ConvertLengthTest < Minitest::Test
  def test_convert_length
    assert_equal 39.37, convert_length(1, 'm', 'in')
  end
end
```
ファイルを保存したらテストコードを実行する。
```shell
~/ruby-book % ruby test/convert_length_test.rb
Run options: --seed 31248

# Running:

E

Finished in 0.000950s, 1052.6316 runs/s, 0.0000 assertions/s.

  1) Error:
ConvertLengthTest#test_convert_length:
NoMethodError: undefined method `convert_length' for an instance of ConvertLengthTest
    test/convert_length_test.rb:5:in `test_convert_length'

1 runs, 0 assertions, 0 failures, 1 errors, 0 skips
```
libディレクトリにconvert_length.rbファイルを作成する。作成したファイルにconvert_lengthメソッドを実装する。
```ruby
def convert_length(length, unit_from, unit_to)
  39.37
end
```
convert_length_test.rbに戻り、実装コードを読み込む。
```ruby
# 以下の1行を追加
repuire_relative '../lib/convert_length'
```
```shell
~/ruby-book % ruby test/convert_length_test.rb
Run options: --seed 3074

# Running:

.

Finished in 0.000739s, 1353.1799 runs/s, 1353.1799 assertions/s.

1 runs, 1 assertions, 0 failures, 0 errors, 0 skips
```

#### いろんな単位を変換できるようにする
2つ目の検証コードを追加する。
```ruby
require 'minitest/autorun'
require_relative '../lib/convert_length'

class ConvertLengthTest < Minitest::Test
  def test_convert_length
    assert_equal 39.37, convert_length(1, 'm', 'in')
    assert_equal 0.38, convert_length(15, 'in', 'm')
  end
end
```
convert_lengthメソッドを実装する。
```ruby
def convert_length(length, unit_from, unit_to)
  units = { 'm' => 1.0, 'ft' => 3.28, 'in' => 39.37 }
  (length / units[unit_from] * units[unit_to]).round(2)
end
```
```shell
~/ruby-book % ruby test/convert_length_test.rb
Run options: --seed 61046

# Running:

.

Finished in 0.001914s, 522.4661 runs/s, 1044.9321 assertions/s.

1 runs, 2 assertions, 0 failures, 0 errors, 0 skips
```
3つ目の実行例も検証する。
```ruby
require 'minitest/autorun'
require_relative '../lib/convert_length'

class ConvertLengthTest < Minitest::Test
  def test_convert_length
    assert_equal 39.37, convert_length(1, 'm', 'in')
    assert_equal 0.38, convert_length(15, 'in', 'm')
    assert_equal 10670.73, convert_length(35000, 'ft', 'm')
  end
end
```
```shell
~/ruby-book % ruby test/convert_length_test.rb
Run options: --seed 1678

# Running:

.

Finished in 0.001027s, 973.7097 runs/s, 2921.1291 assertions/s.

1 runs, 3 assertions, 0 failures, 0 errors, 0 skips
```

#### convert_lengthメソッドを改善する
長さの単位を文字列ではなく、シンボルを渡すように書き換える。
```ruby
require 'minitest/autorun'
require_relative '../lib/convert_length'

class ConvertLengthTest < Minitest::Test
  def test_convert_length
    assert_equal 39.37, convert_length(1, :m, :in)
    assert_equal 0.38, convert_length(15, :in, :m)
    assert_equal 10670.73, convert_length(35000, :ft, :m)
  end
end
```
```shell
~/ruby-book % ruby test/convert_length_test.rb
Run options: --seed 37920

# Running:

E

Finished in 0.002279s, 438.7890 runs/s, 0.0000 assertions/s.

  1) Error:
ConvertLengthTest#test_convert_length:
TypeError: nil can't be coerced into Integer
    lib/convert_length.rb:3:in `/'
    lib/convert_length.rb:3:in `convert_length'
    test/convert_length_test.rb:6:in `test_convert_length'

1 runs, 0 assertions, 0 failures, 1 errors, 0 skips
```
↑シンボルと文字列ではそのままでは互換性がないため、ハッシュから値が取得できずにテストは失敗してしまった。そこで、ハッシュのキーをシンボルに変更する。
```ruby
def convert_length(length, unit_from, unit_to)
  units = { m: 1.0, ft: 3.28, in: 39.37 }
  (length / units[unit_from] * units[unit_to]).round(2)
end
```
```shell
~/ruby-book % ruby test/convert_length_test.rb
Run options: --seed 6190

# Running:

.

Finished in 0.000778s, 1285.3473 runs/s, 3856.0418 assertions/s.

1 runs, 3 assertions, 0 failures, 0 errors, 0 skips
```
convert_lengthにキーワード引数を使用する。
```ruby
require 'minitest/autorun'
require_relative '../lib/convert_length'

class ConvertLengthTest < Minitest::Test
  def test_convert_length
    assert_equal 39.37, convert_length(1, from: :m, to: :in)
    assert_equal 0.38, convert_length(15, from: :in, to: :m)
    assert_equal 10670.73, convert_length(35000, from: :ft, to: :m)
  end
end
```
```shell
~/ruby-book % ruby test/convert_length_test.rb
Run options: --seed 57512

# Running:

E

Finished in 0.001083s, 923.3611 runs/s, 0.0000 assertions/s.

  1) Error:
ConvertLengthTest#test_convert_length:
ArgumentError: wrong number of arguments (given 2, expected 3)
    lib/convert_length.rb:1:in `convert_length'
    test/convert_length_test.rb:6:in `test_convert_length'

1 runs, 0 assertions, 0 failures, 1 errors, 0 skips
```
テストが失敗することを確認したら、キーワード引数を受け取るように実装コードを変更する。
```ruby
def convert_length(length, from: :m, to: :m)
  units = { m: 1.0, ft: 3.28, in: 39.37 }
  (length / units[from] * units[to]).round(2)
end
```
```shell
~/ruby-book % ruby test/convert_length_test.rb
Run options: --seed 5304

# Running:

.

Finished in 0.000878s, 1138.9523 runs/s, 3416.8568 assertions/s.

1 runs, 3 assertions, 0 failures, 0 errors, 0 skips
```
メソッドの中で作成しているハッシュについて見直す。
```ruby
UNITS = { m: 1.0, ft: 3.28, in: 39.37 }
def convert_length(length, from: :m, to: :m)
  units = { m: 1.0, ft: 3.28, in: 39.37 }
  (length / UNITS[from] * UNITS[to]).round(2)
end
```
```shell
~/ruby-book % ruby test/convert_length_test.rb
Run options: --seed 35951

# Running:

.

Finished in 0.000742s, 1347.7092 runs/s, 4043.1276 assertions/s.

1 runs, 3 assertions, 0 failures, 0 errors, 0 skips
```


-------------


## ✍🏻 感想
### 🍒 頭の中が混乱😵‍💫
ハッシュ、キー、値、シンボル、メソッド呼び出し時のキーワード引数、書き方にいくつかのバリエーションがあることなど、インプットした情報が整理できていません。ここは何度も読み書きして慣れるしかありませんね。


------------


### ⏰ 学習時間
- Today:&nbsp;&nbsp;&nbsp; 2 hours 59 min
- Total: 906 hours 42 min
