# 2026/01/22(木)
## 📚 プラクティス『🛠️💻 lsコマンドを作る4』

<details><summary>🎯 学習の狙い</summary>

- 標準出力について学ぶ
- 標準ライブラリの使い方を学ぶ
- Enumeratorには、each以外にも便利なメソッドがあることを学ぶ
- RailsじゃないRubyプログラミングを学ぶ
- メソッド分割を学ぶ
- わかりやすい変数名・メソッド名を学ぶ
- 大きな問題を分割する力を学ぶ
</details>

<details><summary>📌 要件 ※ 随時、追加・変更あり</summary>

- [ ] `-l`オプションが指定された場合は、各ファイルについて「詳細情報（long format）」を一行ずつ表示すること
- [ ] `-l`オプションが指定されていない場合は、これまで通りファイル名のみを表示すること
- [ ] 表示する詳細情報は、以下の内容を含ませること
  - [ ] ファイルタイプ
  - [ ] ファイルモード
  - [ ] リンク数
  - [ ] 所有者
  - [ ] 所有グループ
  - [ ] サイズ
  - [ ] タイムスタンプ（更新日時）
  - [ ] ファイル名もしくはディレクトリ名
- [ ] `gem`は使わずに Ruby の標準ライブラリだけで作ること
- [ ] `rubocop-fjord`でデバッグを実行し、全てパスさせること
- [ ] 完成したコードは GitHub の Pull Request として提出すること

</details>

<details><summary>📍 処理の流れ ※ 随時、追加・変更あり</summary>

1. コマンドライン引数から`-l`オプションの有無を判定する

2. 対象のディレクトリのファイル一覧を配列として取得する

3. `-l`オプションが指定されていない場合 → これまで通り、ファイル名の配列をそのまま表示する

4. `-l`オプションが指定されている場合 → ①配列の各要素（各ファイル）について詳細情報を取得する / ②取得した複数の属性を一行の文字列に整形する

5. 整形済みの各行を上から順に標準出力へ表示させる
</details>

<details><summary> 🧩 タスクばらし ※ 随時、追加・変更あり</summary>

- [ ] タスク1：コマンドライン引数を解析し、`-l`オプションの有無を取得する
- [ ] タスク2：対象のディレクトリのファイル一覧を配列として取得する
- [ ] タスク3：「一つのファイルについて、どんな情報が取れるのか」を調べる
  - [x] ファイルタイプ
  - [ ] ファイルモード
  - [ ] リンク数
  - [ ] 所有者
  - [ ] 所有グループ
  - [ ] サイズ
  - [ ] タイムスタンプ（更新日時）
- [ ] タスク4：取得した「詳細情報（各属性）」を表示する
  - [ ] 先ずはバラバラに値を取り出せるようにする
- [ ] タスク5：複数の属性を整形して表示する
  - [ ] 横に並べて一行にする
- [ ] タスク6：タスク3〜5で行った処理を全てのファイルに対して適用する
  - [ ] 先ずは1ファイルで成功させる
  - [ ] 次に`each`で各ファイルに処理を適用させる
- [ ] タスク7：`-l`オプションが指定されていないときに、`ls`コマンドと同じ挙動になることを確認する
- [ ] タスク8：rubocop-fjord に通す
- [ ] タスク9：提出
  - [ ] 作成した lsコマンドを Pull Request として提出
  - [ ] 提出物に、`ls -l`コマンドの実行結果と、OS標準（macなど自分の使ってるOS）の`ls -l`コマンドの実行結果のスクリーンショットを併記して貼る
  - [ ] rubocop-fjord のチェックが全てパスした画面をスクショして添付
</details>


---


## 🧑🏻‍💻 本日の取り組み
### 📚 プラクティス『🛠️💻 lsコマンドを作る4』 
- 作成したファイルタイプ判定コードの挙動を確認


---


## ⏭️ 次回
### 📚 プラクティス『lsコマンドを作る4』
- ファイルモードについて調べる
- ファイルモードを判定するコードを作成


---


### 💡 本日の学び・気付き
#### 最小のコードで挙動を確認する
これまで作成してきた lsコマンドのコードは、現時点では構造が複雑になってきたと感じたため、先ずは`File::Stat`の挙動だけを切り出した最小構成のコードで確認し、仕組みを理解してから本体へ組み込む方針にした。

検証用として、以下の構成のディレクトリとファイルを作成。
```shell
stat_checkl # File::Statを使う検証用ディレクトリ
├─ test_dir     # テスト用ディレクトリ
├─ file.txt     # テスト用ファイル
├─ link_to_file # テスト用シンボリックリンク
└─ stat_type_check.rb # ファイルタイプを判定するコード
```

作成したファイルタイプの判定コードは次の通り。
```ruby
files = Dir.glob('*', File::FNM_DOTMATCH)

files.each do |file|
  stat = File.lstat(file) # シンボリックリンク判定のため lstat を使用

  if stat.symlink?
    type = 'l'
  elsif stat.directory?
    type = 'd'
  else
    type = '-'
  end

  puts "#{type} #{file}"
end
```
```shell
# 実行結果
~/stat_check % ruby stat_type_check.rb -l
d .
d ..
- file.txt
l link_to_file
- stat_type_check.rb
d test_dir
d .idea
```
シンボリックリンク・ディレクトリ・通常ファイルを判定してくれているみたい。

#### statメソッドとlstatメソッドについて
##### 先ず「stat」とは？
 「このファイルはどんな種類か？サイズは？更新日時は？」と、対象ファイルそのものに質問して情報を取得するためのメソッド。
```ruby
stat = File.stat("file.txt")
```
これは「file.txt本体の情報を取得する」ことを意味する。

##### それに対して「lstat」は？
`lstat`は、シンボリックリンクをリンク自身として扱い、その情報を取得するためのメソッド。

##### 何故 ls -l では lstat が必要なのか？
`ls -l`コマンドは、
- 「これはシンボリックリンク（`l`）」
- 「これはディレクトリ（`d`）」

という「見た目上の種類」を表示するコマンド。
そのため、リンク先ではなくリンクそのものを判定する必要があり、`stat`ではなく`lstat`を用いる必要がある。

参考：[instance method File#lstat](https://docs.ruby-lang.org/ja/4.1/method/File/i/lstat.html)

#### 樹形図で使う記号
樹形図で使用する主な記号は以下の4つ。

|記号   |Unicode   |
|---|---|
|├   |U+251C   |
|└   |U+2514   |
|│   |U+2502   |
|─   |U+2500   |

これらはいずれも罫線用の Unicode文字で、毎回入力するのは手間がかかるため、文字ビューアのお気に入りに登録しておくと便利である。


---


## ✍🏻 感想
### 🧐 ファイルタイプの挙動を確かめる
昨夜作成したファイルタイプを判定するコードの挙動を確かめました。
シンボリックリンク・ディレクトリ・通常ファイルそれぞれを正しく識別し、表示してくれているのでうまくいったと思います。

次回はファイルモードの取得と表示方法について調べ、コードとして実装していく予定です。


---


### ⏰ 学習時間
- Today:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2 hours 16 min
- Total: 1476 hours 27 min
