# 2023/07/14(金) 日報

## 取り組んだ課題
### 『Linuxの基礎コマンドを理解する』
- 『Linux標準教科書』
  - 第9章 シェルスクリプト - 9.1 シェルとシェルスクリプト ~ 9.4 条件分岐 まで修了


## 分かったこと・気付き
### シェルとシェルスクリプト
- シェル
  - 貝殻（＝Shell）という意味。
  - シェルはOSの、カーネル部分を包み込んでいることからその名があり、`対話機能`を提供するものである。
  - シェルはコマンドの入力を受け付けそのコマンドを実行し、入力したユーザに対しその結果を返す役割がある。
- シェルスクリプト
  - 繰り返し行う処理を自動化するための手段。

### プログラミング
- `コンピュータに対して、指示を与え順番に実行させる機能`を`プログラム`という。
- そのプログラムを作成することを`プログラミング`という。
- 今まで学習した`コマンドを条件分岐や繰り返しなど制御機能を加え実行すること`を`シェルスクリプト`という。

#### プログラムの例
- `何かが順序立てて進むもの`を、`プログラム`という。
- 例1）テレビ番組の録画予約：開始時刻から終了時刻とチャンネルを指定し、画質を指定したりする。
- 例2）エアコンの設定：「〇〇度に達したら冷房を入れて、〇〇度を下回ったら冷房を止める」。

#### プログラムの要素
- プログラミングには、どの種類のプログラムでもいくつかの重要な構成要素がある。
- プログラムの要素は主に以下の4つ。
1. `順次実行`
2. `条件分岐`
3. `繰り返し`
4. `サブルーチン`

### シェルスクリプトの作成
#### シェルスクリプトの作成
- シェルスクリプトは、テキストで記述する。
```
yoshiwo@YSWs-MBP ~ % vi lsdate.sh

# (Vimでの操作)以下の内容を記述して保存終了する
#!/bin/bash
ls
date
```

##### シェルの指定
- 1 行目に`#!/bin/bash`と記述。ファイルの 1 行目には、利用するシェルの種類とそのコマンド位置を記述。今回は`bash`を使用。 1行目に利用するシェルを指定、2行目以降に実行するコマンドを1行ずつ入力していく。

##### パーミッションの変更
- 作成したシェルスクリプトの実行には、パーミッションを変更してファイルの実行権限をつける必要がある。
- `パーミッション`：ファイルやディレクトリへのアクセス制御を管理するための仕組み。「w-r--r--」←これ。第8章参照。
```
# lsコマンドでファイルのアクセス権限を確認する
yoshiwo@YSWs-MBP ~ % ls -l lsdate.sh
-rw-r--r--  1 yoshiwo  staff  20  7 14 08:14 lsdate.sh

# 実行権限を付与するためにchmodコマンドを使う
yoshiwo@YSWs-MBP ~ % chmod u+x lsdate.sh # lsdate.shファイルにおいて、userにexecute(実行)権限を付与する
yoshiwo@YSWs-MBP ~ % ls -l lsdate.sh
-rwxr--r--  1 yoshiwo  staff  20  7 14 08:14 lsdate.sh # userにexecuteが付与されたことを確認

# ./はパス指定。「カレントディレクトリにある(ladate.shを実行せよ)」という意味。パスが通っているため、Vimで書いたlsコマンドやdateコマンドが順に実行される
yoshiwo@YSWs-MBP ~ % ./lsdate.sh
Applications		cat-output		mysql			umask022
Desktop			chownfile		ruby-book		uniq-sample
Documents		codes			score			update
Downloads		editfile.txt		study			vicopypaste.txt
Library			exit			test.txt		vicutlinepaste.txt
Movies			file1			test1			vicutpaste.txt
Music			file2			translate		vicutpasteundo.txt
Pictures		ichiyasa		translate2		viinsert.txt
Public			idbitfile		umask0022		vimove.txt
TEST			lsdate.sh		umask0070		vireplace.txt
TwitterHeader		manual-less		umask0072		work # ここまでがlsの実行結果
2023年 7月14日 金曜日 08時27分01秒 JST # dateの実行結果
```

### パスワードとパスワードファイル
- グループの定義は/etc/groupファイル（グループファイル）に、ユーザの定義は/etc/passwdファイル（パスワードファイル）に記述されている。
- ユーザを利用するにはパスワードが必要で、パスワードは/etc/shadowファイル（シャドウファイル）に暗号化されて記録される。
- パスワードの変更はpasswdコマンドを使って行う。

#### パスワードファイル(/etc/passwd)
- ユーザの情報は/etc/passwdファイルに（パスワードファイル）に保存され、1行に1ユーザの情報を「:」で区切って記述する。
- `account:password:UID:GID:GECOS:directory:shell` **※GECOS = General Electric Comprehensive Operationg System**
- 従来はパスワードファイルに暗号化されたパスワードを記述していた。
- 多くのディストリビューションはセキュリティを考慮してシャドウファイルにパスワードを記述している。
- パスワードファイルはエディタで直接編集せずに、useraddコマンドなどのコマンドを使って操作することが推奨されている。

##### パスワードファイルの内容
| 項目 | 内容 |
| :---: | :--- |
| account | そのシステムでのユーザ名。大文字を含まないようにする |
| password | 以前はユーザの暗号化されたパスワード、現在は ‘x’ |
| UID | ユーザID番号 |
| GID | ユーザが属するプライマリグループID番号 |
| GECOS | ユーザの名前またはコメントのフィールド |
| directory | ユーザのホームディレクトリ |
| shell | ログイン時に起動されるユーザのコマンドインタプリタ |

#### グループファイル(/etc/group)
- グループの情報は/etc/groupファイル（グループファイル）に保存され、1行に1グループの情報を「:」で区切って記述する。
- `group_name:password:GID:user_list`

##### グループファイルの内容
| 項目 | 内容 |
| :--: | :-- |
| group_name | グループの名前 |
| password | 以前は暗号化されたグループのパスワード、またはパスワードが不要なら空欄 |
| GID | グループID番号 |
| user_list | グループに所属するユーザ名のリスト。それぞれの ユーザ名はコンマで区切られる。 |


#### パスワード
- ユーザの権限を使うにはユーザ名とパスワードを使って認証する。
- 作成したユーザはパスワードを登録するとログインできるようになる。
- ユーザのパスワードを登録・変更するにはpasswdコマンドがある。
- パスワードの登録はパスワードが必要なので、初めてパスワードを変更するにはrootユーザ（スーバーユーザ）である必要がある。

#### シャドウファイル(/etc/shadow)
- ユーザのパスワードはパスワードファイルではなく、シャドウファイル(/etc/shadow)に保存される。
```
account:password:last_changed:may_be_changed:must_be_changed:warned:expires:dis abled:reserved
```

##### シャドウファイルの内容
| 項目 | 内容 |
| :---: | :--- |
| account | ユーザ名 |
| password | 暗号化されたパスワード |
| last_changed | 1970年1月1日から、最後にパスワードが変更された日までの日数 |
| may_be_changed | パスワードが変更可能となるまでの日数 |
| must_be_changed | パスワードを変更しなくてはならなくなる日までの日数 |
| warned | パスワード有効期限が来る前に、ユーザが警告を受ける日数 |
| expires | パスワード有効期限が過ぎ、アカウントが使用不能になるまでの日数 |
| diabled | 1970年1月1日からアカウントが使用不能になる日までの日数 |
| reserved | 予約フィールド |

### 用意されているユーザとグループ
- Linuxはインストールしてすぐにそのシステムを利用できるように、ユーザとそのユーザが所属するグループが用意されている。
- ユーザやグループは必要に応じて複数追加できる。

#### 一般のユーザとグループ
- Linuxにログインするにはアカウントが必要。
- アカウントを作成するとユーザ名と同様の名前のグループが作られ、ユーザはそのユーザグループに所属しているとシステムに登録される。
- グループは複数のユーザをまとめるためにある。

#### rootユーザ
- rootユーザは`システム設定の変更や、プログラムのインストールや削除、ユーザを作成・削除することができる、利用に制限がない特別なユーザ`。
- rootユーザは`アクセス権に関係なく全てのユーザーのディレクトリへのアクセス、コンテンツの読み書きが行える`などの点で一般ユーザとは異なる。
- `rootユーザでログインできれば全ての操作を行うことができてしまう`ので、rootユーザのアカウントは`厳格に管理`しなくてはならない。

#### suコマンド
- `suコマンド`は別のユーザでログインしているユーザが、`一時的に他のユーザになるためのコマンド`。
- suコマンドを実行する際、`オプションとしてユーザを指定しない場合はrootユーザでシェルを起動`する。
- オプションを付けずにsuコマンドを実行した場合はカレントディレクトリを変更せずにrootユーザでログインする。
- カレントディレクトリをrootのホームディレクトリに変更してログインするには「su -」若しくは「su - root」と実行することでカレントディレクトリを変更した上でrootユーザでログインできる。
- rootユーザでログインすると、システム管理用のコマンドを実行することができる。
  - 一般ユーザからrootユーザへ切り替えると、`rootユーザで作業を開始した時間などは直ぐにわかる`。
  - 安全や管理を考慮すると、`一般のユーザでログインしてからrootユーザの権限を取得し、システム作業することが望ましい`。

#### rootユーザでコマンドを実行するsudoコマンド
- sudoコマンドを使えば、スーパーユーザ（root）権限でコマンドを実行できる。
- -uオプションを付けてsudoコマンドを実行すると、任意のユーザでコマンドを実行できる。
- オプションを付けずにsudoコマンドを実行した場合はroot権限でコマンドを実行する。

### ファイルの所有者と所有グループ
- ファイル作成者の`ユーザIDとグループID`が`ファイルの所有者と所有グループ`となる。
- 所有者と所有グループはファイルの情報として重要な属性。
- `所有者はchownコマンドで変更`でき、`所有グループはchgrpコマンドで変更`できる。

#### 所有者の変更
- ファイルの所有者を変更するにはchownコマンドを使う。

#### 所有グループの変更
- ファイルの所有グループを変更するにはchgrpコマンドを使って行う。

### ファイルとアクセス権
- ファイルはファイルを所有するユーザ、ファイル所有グループからファイル所有者を除いたユーザー、その他のユーザの3つのレベルで権限を設定できる。
- ファイルには`読み・書き・実行`の3つの権限がある。
- ファイルのモードを変更するにはchmodコマンドを使う。

#### ファイルに設定できるアクセス
- ファイルのモードは読み・書き・実行の3つの権限がある。
- lsコマンドに-lオプションを付けて表示される1つ目のカラムがファイルのモードを示している。
```
d rwx rwx rwx
# 左から ファイル種別 所有ユーザー 所有グループ その他
```

##### ファイル種別の r, w, x の意味
| 項目 | 内容 |
| :---: | :--- |
| r | 読み込み |
| w | 書き込み |
| x | 実行またはディレクトリの移動 |
- rが表示されればファイルの読み込みが可能。
- wが表示されればファイルの書き込みが可能。
- xが表示されればファイルをプログラムとして実行できるか、または、ディレクトリであればディレクトリへ移動できる。

#### アクセス権の変更
- ファイルのアクセス権を変更するにはchmodコマンドを使う。
- 書式
  - `chmod モード [, モード]… ディレクトリ`
  - `chmod モード [, モード]… ファイル`
  - `chmod 8進数表記のモード ディレクトリ`
  - `chmod 8進数表記のモード ファイル`
- ファイルのモードを所有ユーザと所有グループとそれ以外のユーザについて設定する。モード指定の書き方で以下の2通りの記述方法がある。
1. モードの書式を複数書き、カンマで区切って指定。
2. 8進数3桁で各ユーザのレベルを指定。

- モードの指定に`setuidビット`、`setgidビット`、`stickyビット`という、特殊な属性がある。
- setuidビットあるいはsetgidビットが付いたプログラムを実行すると、ファイル所有者あるいは所有グループの権限で実行される。
- rootユーザ所有で setuid ビットが セットされたプログラムは、一般ユーザが実行した場合でもrootユーザが実行した場合と同じ動作をする。
- stickyビットが付いたディレクトリ内のファイルは所有者以外が削除できなくなる（Linux では、ファイルについてのスティッキービットは無視される）。
- Linux では一般的に /tmp ディレ クトリにスティッキービットが付与されている。

#### ファイル作成のモード
- ファイルを新規に作成すると、ユーザごとに規定されたパーミッションである 644、若しくは 664 といったパーミッションが設定されてファイルが作成される。
- `umaskコマンド`を使うことで、指定したパーミッションでファイルを作成するように制限できる。
- 書式
  - `umask [8進数のモードのマスク値]`
- 現在のマスク値を表示
  - umask コマンドに続けてマスク値を指定しなかった場合、現在のマスク値を表示できる。
- マスク値を変更
  - umask コマンドに続けてマスク値を指定すると、コマンドを実行後に作成されるファイルが指定したパーミッションで作成できる。umask コマンドは許可しないビットを指定する。umask コ マンドで指定するマスク値は、すべてのユーザが読み書きできるパーミッション 666 から、設定したいパーミッションを引き算することでマスク値を求めることができる。
 

## 次の目標
- 『Linux標準教科書』 第10章まで修了


## 感じたこと
- いつもハンズオンでコマンドの挙動を確かめているお陰でmacOSにはないコマンド(useraddコマンド、userdelコマンド、groupaddコマンド、groupdelコマンド)を把握することができました。
- 先日立てた学習計画よりも進みが遅いのでスピードを意識してインプット学習を行いたいと思います。


## 学習時間
- Today:&nbsp;&nbsp; 5 hours 04 min
- Total: 339 hours 18 min
