# 2023/07/20(木) 日報

## 取り組んだ課題
### 『Linuxの基礎コマンドを理解する』
- 『Linux標準教科書』
  - 第12章 12.1.3 Linux のディレクトリ構造 ~ 12.10 ディスクを管理するコマンド　まで修了


## 分かったこと・気付き
#### ディスクのパーティション
- fdiskコマンドで、分割されたパーティションの情報を調べたり、パーティションを作成、削除できる。

##### パーティション分割する理由
- システムとデータのバックアップ頻度を差別化する
- 障害発生時の影響範囲を狭める
- ファイルアクセスの速度向上
- 書式
```
fdisk [オプション] [デバイスファイル]
ディスクの構造を表示。
ディスクをパーティション分割する。
```
オプション
```
-l
デバイスのパーティション情報を表示。
```

##### パーティションの分割
- ハードディスクは、1つのパーティションとして使うか、2~4つまでのパーティションに分割できる。

##### パーティション分割の例
- 基本パーティションを4つ
- 基本パーティションを3つ＋拡張パーティションを1つ (論理パーティションを2つ)
- 論理パーティションは、基本パーティションと同様にファイルシステムを作成して、ファイ ルやディレクトリを保管できる。拡張パーティションは、論理パーティションを格納する役割となっており、ファイルシステムを作成することはできない。

##### パーティションの最大数
- IDE：63（基本 3 ＋論理 60）
- SATA：15（基本 3 ＋論理 12）
- SCSI：15（基本 3 ＋論理 12）
- Linux では4つ以上のパーティションが必要となるケースが多いので、拡張パーティション1つと他の3つを基本パーティションという構成で使う場合が多くなる。また、拡張されたハードディスクは基本パーティション1つや、LVM(Logical Volume Managemer) 機能を使って複数のハードディスクを統合した1つのハードディスクとして大きく使うことも多い。

##### ハードディスクを増設して利用可能にする
- 新しいハードディスクには、データ用の領域と、スワップ領域 (Linux がメモリの代わりにプログラムを置いておく領域) の2つを作成する。
- パーティションの操作はシステム管理の仕事なので、root ユーザでfdiskコマンドを実行する必要がある。

#### ファイルシステム
- ファイルシステムとは、ディレクトリやファイルの情報やデータをディスクの何処に保存してあるか管理するためのシステムのこと。
- ファイルシステムはディレクトリやファイルのファ イル名、ファイルの作成時間、ファイルの所有権限などの情報を管理している。
- ディスクのデータが書いてある場所とデータが書いていない場所なども管理している。
- Linuxの場合はディストリビューションよって異なるが、ext3もしくはext4がファイルシステムに利用されている。
	- ディストリビューション：Linuxの仕組みをベースにしたソフトウェアの集まり。

##### Linux で利用できるファイルシステムの一例
| FS 名 | 内容 | 最大サイズ | 最大ファイルサイズ |
| :---: | :--- | :---: | :---: |
| ext2 | Berkeley Fast File System を参考にした 16 ビット構造 | 16TB | 2TB |
| ext3 | ext2 にジャーナル機能付加と機能拡張 | 2～32TB | 16GB～2TB |
| ext4 | ジャーナリングファイルシステム。ファイルの断片化防止などさまざまな機能拡張によりパフォーマンスが向上 | 1EB | 16TB |
| ReiserFS | 小さなファイルの扱いに向いたジャーナリングファイルシステム | 8TB | 16TB |
| XFS | SGI社が提供したジャーナリングファイルシステム | 8EB | 8EB |
| JFS | IBM社が提供したジャーナリングファイルシステム | 512TB | 4PB～8EB |

##### 容量の単位
- 1M(メガ) バイト=1024K バイト 1G(ギガ) バイト=1024M バイト
- 1T(テラ) バイト=1024G バイト 1P(ペタ) バイト=1024T バイト
- 1E(エクサ) バイト=1024P バイト 1Z(ゼタ) バイト=1024E バイト

##### ジャーナリング機能
- ジャーナリングとは、ファイルシステムに対する書き換え処理のコマンドをファイルシステムに逐一記録する機能のこと。

##### マウント状態の表示
- `dfコマンド`で現在マウントされているファイルシステムのリストを表示できる。
-実習：ハードディスクの確認
```
YSWs-MBP:~ yoshiwo$ df
Filesystem     512-blocks      Used Available Capacity iused      ifree %iused  Mounted on
/dev/disk1s1s1  976490576  17696840 814540968     3%  355382 4072704840    0%   /
devfs                 384       384         0   100%     666          0  100%   /dev
/dev/disk1s3    976490576   4336360 814540968     1%    1952 4072704840    0%   /System/Volumes/Preboot
/dev/disk1s5    976490576   6291496 814540968     1%       3 4072704840    0%   /System/Volumes/VM
/dev/disk1s6    976490576      9896 814540968     1%      16 4072704840    0%   /System/Volumes/Update
/dev/disk1s2    976490576 131060656 814540968    14%  840032 4072704840    0%   /System/Volumes/Data
map auto_home           0         0         0   100%       0          0  100%   /System/Volumes/Data/home
/dev/disk2s2      2343752   1337336   1006416    58%     998 4294966281    0%   /Volumes/Arc
```

##### ファイルシステムの作成
- ハードディスクを利用するためには、パーティションに分割した後ファイルシステムを作成する。
- ファイルシステムの作成にはmkfsコマンドを使用する。
- 書式
```
mkfs オプション
```
- オプション
```
-t
作成するファイルシステムの種類を指定する。

-c
ハードディスクの壊れている箇所を検出して、利用しない。
```

##### ラベル
- ラベルとは、ハードディスクなどのパーティションを認識するための名前のこと。
- 書式
```
e2label デバイス [ラベル]
パーティションのラベルを表示する。
パーティションのラベルを付ける。
```
**※↓ターミナルではマニュアルに登録されていないと表示。**
```
YSWs-MBP:~ yoshiwo$ man e2label
No manual entry for e2label
```

#### マウント
- ハードディスクはパーティション分割してファイルシステムを作ってからマウントすると読み書きできる。
- CD-ROM や DVD-ROM などのリムーバブルメディアもマウントすると読めるようになる。

##### マウントポイント
- マウントするために利用するディレクトリをマウントポイントと呼ぶ。
	- マウント：外部のデバイス（例えばUSBメモリやハードディスク）を、コンピュータ内の特定の場所に接続して使えるようにすることを意味する。マウントは、外部デバイスをコンピュータに「つなげる」作業をイメージするとよい。マウントが完了すると、コンピュータは外部デバイスの中身を見ることができるようになる。

##### マウント（mountコマンド）
- ハードディスクやリムーバブルメディアなどをマウントポイントにマウントするためにmountコマンドを使う。
- 書式
```
mount -t タイプ -o オプション デバイスファイル マウントポイント
ハードディスクやリムーバブルメディアをマウントする。
```
- オプション
```
-t タイプ
ファイルシステムのext3やWindowsのmsdosCDとDVDのiso9660など

-o オプション
読み書きのrwや読み取り専用のroなど

デバイスファイル
ファイルシステムをアクセスするためのデバイスファイル

マウントポイント
マウントするディレクトリ
```

##### アンマウント（umountコマンド）
- マウントされたハードディスクやリムーバブルメディアを利用しなくなると、アンマウントする。
- アンマウントするために`umountコマンド`を使う。

#### スワップ領域の作成
- Linuxのカーネルと呼ばれる根幹のプログラムは、ハードディスクからプログラムやデータをメモリ領域へ読み込んで実行する。
- プログラムやデータを新たに読み込むための空きメモリ領域がなくなると、Linuxのカーネルは今利用していないメモリ上のプログラムやデータをスワップ領域へ一時的に退避する。

##### スワップファイルシステムの作成
- スワップするためのパーティション確保、ファイルシステムの作成は、インストールするときや新しくハードディスクを増設するときに実行する。
- スワップ領域 (スワップのパーティション) を作るにはmkswapコマンドを使う。
- 書式
```
mkswap デバイスファイル
スワップファイルシステムを作る。
```
- オプション
```
-c
不良な部分を探して利用しない

デバイスファイル
ファイルシステムをアクセスするためのデバイスファイル
```

##### スワップの領域作成と利用
- スワップ領域は作成した後にswaponコマンドを実行すると有効化できるようになります。
**※ターミナルにswaponコマンドはありませんでした。**
- 書式
```
swapon [デバイスファイル]
```
- オプション
```
-s
現在利用しているスワップ領域を表示
```
- 利用中のスワップ領域は swapoff コマンドで無効化。
- 書式
```
swapoff [デバイスファイル]
```
- オプション
```
-v
指定したスワップを無効化

-a
すべてのスワップを無効化
```

#### 自動マウント
- インストール時に作られたパーティションは、コンピュータの起動時に自動マウントされる。
- 起動時に自動マウントされる設定を記述するファイルは/etc/fstabというパスにある設定ファイル。
- 自動マウントには mount コマンドが使われる。
- /etc/fstab ファイルに記述されるのは次の項目。
	- ブロックスペシャルデバイス
	- マウントポイント
	- ファイルシステムのタイプ (ext3,swap など)
	- オプション (カンマで区切る)
	- dump コマンドがダンプ (バックアップ) するか否か (0・・・ダンプ不要,1・・・ダンプ)
	- ブート時にチェックする順番
- 書式
```
mount -a
デバイスをマウントする。
```
- オプション
```
-a
/etc/fstabファイルに指定されたswap以外のパーティションをマウント
```

#### CD/DVD/USB メモリ (リムーバブルメディア) の利用
- 電源を入れたまま取り外したり装着してメディアを取り替えられるリムーバブルな外部記憶装置 として、CD/DVDドライブやUSBメモリがある。
- リムーバブルメディアを使用する場合、手動でマウントをする必要がある。

##### CD/DVD のマウント
- CD/DVDをLinuxで使用するには、mountコマンドでマウントを行なう。

##### CD/DVD のアンマウントと取り出し
- マウントしたCD/DVDを取り出すには、umountコマンドでアンマウントを行なう。

##### アンマウントできない場合
- マウントポイントが使用中であったり参照中の場合はアンマウントすることはできない。
- 具体的に言うと、マウントポイント以下がカレントディレクトリである場合や、リムーバブルメディア に含まれるファイルを参照している場合など。

#### iノード
- ext3(ext2) ファイルシステムは、ファイルやディレクトリに対し、iノード番号というユニークな 番号を割り振って管理している。
- ファイルシステムを作成した時に iノード領域という場所が確保される。
- iノード領域には、ファイルがディスク上にある位置やアクセス権限などの情報が保持されている。

##### iノード情報の確認
- ext3 ファイルシステムの iノード領域の使用状況を確認するには、df コマンドに-i オプションを付けて実行する。
- iノード情報として、全体の数、使用している数、残りの数、使用量 (%) が表示される。
- 書式
```
df -i
ファイルシステムの情報を表示。
```
- オプション
```
-i
iノード情報の表示。
```
- 実習：iノード情報の表示
```
YSWs-MBP:~ yoshiwo$ df -i  # iノード情報を表示
Filesystem     512-blocks      Used Available Capacity iused      ifree %iused  Mounted on
/dev/disk1s1s1  976490576  17696840 814506784     3%  355382 4072533920    0%   /
devfs                 384       384         0   100%     666          0  100%   /dev
/dev/disk1s3    976490576   4336360 814506784     1%    1952 4072533920    0%   /System/Volumes/Preboot
/dev/disk1s5    976490576   6291496 814506784     1%       3 4072533920    0%   /System/Volumes/VM
/dev/disk1s6    976490576      9896 814506784     1%      16 4072533920    0%   /System/Volumes/Update
/dev/disk1s2    976490576 131094840 814506784    14%  840130 4072533920    0%   /System/Volumes/Data
map auto_home           0         0         0   100%       0          0  100%   /System/Volumes/Data/home
/dev/disk2s2      2343752   1337336   1006416    58%     998 4294966281    0%   /Volumes/Arc
```

##### iノード番号の確認
- ファイルに割り振られている iノード番号を確認するには、ls コマンドに-i オプションを付けて実行する。
- 実習：iノード番号の確認
```
YSWs-MBP:~ yoshiwo$ ls -il /bin | sort  # iノート番号を表示
1152921500312434706 -rwxr-xr-x  2 root  wheel   134224  6 15 19:08 [
1152921500312434706 -rwxr-xr-x  2 root  wheel   134224  6 15 19:08 test
1152921500312434708 -r-xr-xr-x  1 root  wheel  1326752  6 15 19:08 bash
1152921500312434710 -rwxr-xr-x  1 root  wheel   135408  6 15 19:08 cat
1152921500312434712 -rwxr-xr-x  1 root  wheel   136960  6 15 19:08 chmod
1152921500312434714 -rwxr-xr-x  1 root  wheel   152800  6 15 19:08 cp
```

#### ハードリンクとシンボリックリンク
- リンク機能は、ファイルをコピーしたり移動したりせずに、別のディレクトリにあるように扱うことができる機能。
- リンクには、ハードリンクとシンボリックリンクの 2 種類がある。

##### ハードリンク
- ハードリンクは、ファイルの実体を直接指し示して共有する。
- ハードリンクを削除しても、元ファイルは削除されない。
- ハードリンクはiノード番号を共有することで実現しているため、別ファイルシステム（別パーティション）には作成することができない。

##### シンボリックリンク
- シンボリックリンクは、元ファイルが保管されている位置（パス）を示す擬似的なファイルを作る。
- シンボリックリンクを消しても元ファイルに影響はない。
- 元ファイルを消すとシンボリックリンクからのアクセスがエラーとなる。
- シンボリックリンクは別ファイルシステムの間で作成することができる。
- 書式
```
ln 元ファイル名 リンク名
```
- オプション
```
-s
シンボリックリンクを作成する。
-s オプションを付けない場合はハードリンクを作成する。
```

#### ディスクを管理するコマンド
- ハードディスクを管理するコマンドとして、ファイルシステムをチェックして修復するfsckコマンドや、ファイルやディレクトリが使っているディスク容量を調べる`duコマンド`がある。

##### ファイルシステムのチェックと修復
- コンピュータが異常終了するなど正常にシャットダウンが行われないと、ファイルシステムのファイル管理情報とハードディスクに書き込まれたデータとの間で辻褄が合わなくなることがある。
- ファイルシステムが不整合に陥った場合、`fsckコマンド`を使って整合性をチェックし、修復を行なう必要がある。
- fsckコマンドは、異常終了した後のシステム起動時に自動的に実行される。
- 書式
```
fsck デバイス名
ファイルシステムのチェックと修復をする。
```
##### fsck とジャーナリング機能
- ジャーナリング機能を持つ ext3 ファイルシステムは、ジャーナル情報があるので修復が素早く行える。
- 一方、ext2 ファイルシステムはジャーナル情報がないので、全ての管理情報が正しいかチェックする必要があるので修復にとても時間が掛かる。

##### ディレクトリ使用量の確認
- 細かいディレクトリの使用量を調べるには duコマンドを使う。
- 書式
```
du [ディレクトリ]
du [ファイル]
ディレクトリの使用量を調べる
ファイルのサイズを調べる
```
- オプション
```
-s
指定ファイルや指定ディレクトリの総計を表示。
```

## 次の目標
- 『Linux標準教科書』 第12章 章末テスト 修了
- 記事の制作に着手


## 感じたこと
- 『Linux標準教科書』は第12章の章末テストを残すのみとなりました。最後まで気を抜かずに励みます。


## 学習時間
- Today:&nbsp;&nbsp;&nbsp; 3 hours 14 min
- Total: 354 hours 28 min
