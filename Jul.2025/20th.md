# 2025/07/20(日)
## 📚 プラクティス『プログラムの修正（リバーシ編）』


### 🧩 タスクばらし
- [x] プラクティスの内容を咀嚼
- [x] タスクばらし、スモールステップの作成
- [x] ソースコードの言語化
- [ ] ソースコードを修正
- [ ] 課題提出


### 🐾 スモールステップ
<details><summary>プラクティスの内容を咀嚼</summary>

- [x] プラクティスの内容を咀嚼
</details>

<details><summary>タスクばらし、スモールステップの作成</summary>

- [x] タスクばらし、スモールステップの作成
</details>

<details><summary>ソースコードの言語化</summary>

- [x] ソースコードの言語化 **※①から順に行う**
  - [x] ① reversi_methods_test.rb
  - [x] ② reversi.rb
  - [x] ③ reversi_methods.rb
  - [x] ④ position.rb


</details>

<details><summary>ソースコードを修正</summary>

- [ ] ソースコードを修正
  - test_cannot_put_stone
    - [ ] 修正
  - test_finished_of_quickest_win_board
    - [ ] 修正
  - test_put_stone
    - [x] 修正
  - test_turn
    - [x] 修正
  - test_finished_of_full_board
    - [ ] 修正

</details>

<details><summary>課題提出</summary>

- [ ] 修正したソースコードを Pull Request としてアップ
- [ ] Pull Request としてアップした URL とテストコードの実行結果を提出
</details>


---
### 🧑🏻‍💻 本日の取り組み
#### プラクティス『プログラムの修正（リバーシ編）』
- テスト結果をよく読み、理解する


---


### 🎯 次回
#### プラクティス『プログラムの修正（リバーシ編）』
- 以下のことを意識しながら`binding.break`を書き込み、挙動を一つずつ確認する
  - **①テストファイル中のどの行の検証メソッドが落ちてしまったのか。**
  - **②検証メソッド→その失敗が ReversiMethodsTest のどのインスタンスメソッドに対応するのか？**
  - **③assertは（真を期待） / refuteは（偽を期待）する**
  - **④行番号とメソッド名を手がかりに、reversi_method.rbの返り値を見直し、テストが期待する値を返すように修正する**
    

---


### 💡 本日の学び・気付き
#### テスト結果をもう一度理解する
```shell
~/bug_reversi/test % ruby reversi_methods_test.rb 
Run options: --seed 5627

# Running:

..F..FF..

Finished in 0.004859s, 1852.2330 runs/s, 3292.8586 assertions/s.

  1) Failure:
ReversiMethodsTest#test_cannot_put_stone [reversi_methods_test.rb:73]:
Expected true to not be truthy.

  2) Failure:
ReversiMethodsTest#test_finished_of_quickest_win_board [reversi_methods_test.rb:120]:
Expected false to be truthy.

  3) Failure:
ReversiMethodsTest#test_finished_of_full_board [reversi_methods_test.rb:107]:
Expected false to be truthy.

9 runs, 16 assertions, 3 failures, 0 errors, 0 skips
```
##### Expected true to not be truthy.
- エラーメッセージの先頭にある`Expected`は、「**期待していた結果**」を示す言葉。
  - expected：予想[予期]された
- 直訳すると、「（テストでは） true が"truthyではない"ことを期待(予想)したのに、実際は true（truthy）だった」という意味合いになる。
- `Expected`：テストが「こうであってほしい」と思っていた結果。
- `true`：実際にメソッドから返ってきた値。
- `to not be truthy`：「truthy（真とみなされる）ではない」という条件（false または nil であってほしい）。

まとめると
- `Expected`は「期待（予想）していたもの」を表すキーワード。
- その後に続く`true`は、テスト実行時に実際に帰ってきた値。
- 結果として「実際には`true`が値として返ってきたけれど、本当は`false`（truthyではない）が返ってくることを想定していたよ」というエラー内容。

ちなみに、`truthy`は
- プログラミング界隈でよく使われる用語（いわゆる「ジャーゴン（jargon）」）で、英語辞典には載っていないことがほとんど。ジャーゴン（jargon）とは、「専門用語」「特殊な言い回し」という意味。偽と判定される値、`falsy`という言い回しもある。

[MDN Web Docs用語集 > Truthy（真値）](https://developer.mozilla.org/ja/docs/Glossary/Truthy)
[MDN Web Docs用語集 > Falsy（偽値）](https://developer.mozilla.org/ja/docs/Glossary/Falsy)

##### Expected false to be truthy.
- `Expected`：テストが「こうであってほしい」と思っていた結果。
- `false`：実際にメソッドから返ってきた値。
- `to be truthy`：「truthy（真として扱われる）であってほしい」という条件。つまり、`false`ではなく`true`などの`truthy`な値が返ってくることをテストでは期待（予想）していた。

まとめると
- 「テストではこのメソッドが`truthy`な値（`true`や`nil`以外）を返すことを期待（予想）していたのに、実際には`false`が返ってきてしまった」という意味。

##### [reversi_methods_test.rb:73]
- `reversi_methods_test.rb`：テストが書かれているファイル名。
- `73`：`reversi_methods_test.rb`ファイルの73行目で失敗した、と場所を指している。

つまり、
- 「テストファイルの73行目にあるコードを実行したが、期待した結果にはならなかった」という意味。

ちなみに、
- 「**落ちました**」というのは、「実行時にプログラムがクラッシュした」ではなく、「**テストが失敗した（期待通りの結果にならなかった）**」という意味。

具体的には：
```ruby
refute put_stone(board, 'b1', BLACK_STONE)
```
この一行を実行したときに、
- `refute`：「この式は偽（`false`か`nil`）であるはず」と想定する
- でも、実際には`put_stone(board, 'b1', BLACK_STONE)`が`true`を返してしまったので、
- 「期待していた値（偽）ではない！（テストは）失敗だ！」となり、
- テスト結果には`Failure`（不合格）として出力される。

これを「**テストが落ちた**（テストが失敗した）」と言う。
同様に
- `[reversi_methods_test.rb:120]` → 120行目
- `[reversi_methods_test.rb:107]` → 107行目

でも別のテスト検証が失敗している。

##### 検証メソッドについて
`reversi_methods_test.rb`ファイルに書かれている**検証メソッド**をよく見ると、チェリー本（p. 89）に載っていた検証メソッドと同じものが確認できる。
```ruby
# a が真であればパス（テストが成功）する
assert a

# a が偽であればパス（テストが成功）する
refute a
```
- `test_cannot_put_stone`
  - 「置けない（`false`を返す）こと」を確かめるテスト。
  - `reversi_methods_test.rb`ファイル73行目の`refute put_stone(board, 'b1', BLACK_STONE)`がここに該当する。
- `test_finished_of_quickest_win_board`
  - 「白石または黒石が最短で勝利した場合にリバーシが終了（`true`）になること」を確かめるテスト。
  - `reversi_methods_test.rb`ファイル120行目の`assert finished?(build_board(<<~BOARD))`がここに該当する。
- `test_finished_of_full_board`
  - 「盤面が全て石で埋まったらリバーシが終了（`true`）になること」を確かめるテスト。
  - `reversi_methods_test.rb`ファイル107行目の`assert finished?(build_board(<<~BOARD))`がここに該当する。

まとめると、
- `assert a`
  - `a`が`truthy`（真とみなされる値）であることを期待（予想）する。
  - 成功時はテストをパスし、落ちたなら`Expected false to be truthy.`に。
- `refute a`
  - `a`が`false`または`nil`（偽とみなされる値）であることを期待（予想）する。
  - 成功時はテストをパスし、落ちたなら`Expected true to not be truthy.`に。


---


### ✍🏻 感想
#### 🤝🏻 テストコードとも仲良くなろう！
`binding.break`をポチポチ操作しているときに「**テストコードを活用するとデバッグの効率は高まる**」といった文言をふと思い出しました。そこで、書籍『コードが動かないので帰れません！』のテストコードについての記述を読み返し、改めてテスト結果の内容をじっくり確認してみることにしました。

テスト結果の一行、一単語を調べてみると今まで「何となく眺めていた」だけで、テスト結果が伝えたかったことを全く理解していない（受け止めていない）ことに気付きました。

今回も自分の言葉で丁寧に言語化していくうちに、「もしかしてだけど、ここを直すといいのでは？」と考えられるようになりました（合っているかは分かりませんが🤔）。今週中には修正を終えてメンターさんに課題を提出することを目指して頑張ります。


---


### ⏰ 学習時間
- Today:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 hours 05 min
- Total: 1163 hours 12 min
