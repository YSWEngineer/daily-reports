# 2025/09/16(火)
## 📚 プラクティス『lsコマンドを作る1』

:::details 🎯 学習の狙い
- 標準出力について学ぶ
- 標準ライブラリの使い方を学ぶ
- Enumeratorには、each以外に便利なメソッドがあることを学ぶ
- RailsじゃないRubyプログラミングを学ぶ
- メソッド分割を学ぶ
- わかりやすい変数名メソッド名を学ぶ
- 大きな問題を分割する力を学ぶ
:::

:::details 📌 要件（Docs：lsコマンドを作る 参照）
- [ ] オプション（`-a`や`-r`など）を付けず、且つ引数（フォルダのパス）も指定せずに実行する
- [ ] そのまま実行すると、今いるフォルダ（カレントディレクトリ）の中身を表示する
- [ ] `gem`は使わずに Ruby の標準ライブラリだけで作ること
- [ ] 完成したコードは GitHub の Pull Request として提出すること
- [ ] `rubocop-fjord`でデバッグを実行し、全てパスさせること
- [ ] 2つ以上のメソッドを自分で定義すること
- [ ] 表示は横に最大3列になるようにレイアウトすること
  - 3, 6, 9, 12のように3の倍数の件数だけでなく、最後の列に空欄ができるケースの結果も載せる
  - 「3列から5列に仕様変更してください」または「3列から100列に変えてください」とあとから言われても必要最小限の変更で対応できるようなロジックにしておくこと
:::

:::details 📑 全体の設計 （⚠️ ネタバレに注意）
#### 1. ファイルの取得（ソート含む）
- 入力：検索パターン
- 処理：`Dir.glob`で指定パターンに合うファイルやディレクトリを取得し、並び替え
- 出力：ファイル・ディレクトリ一覧（配列でまとめたもの）

#### 2. 行数の計算
- 入力：ファイル（要素）を配列でまとめたものと列数
- 処理：`行数 = (要素の数 ÷ 列数).ceil`で余りを切り上げる
- 出力：行数（Integer = 整数）

#### 3. 要素一つ一つを縦に配置
- 入力：ファイル（要素）を配列でまとめたもの、行数・列数
- 処理：①行ごとの配列を作る　②各列に要素を縦に配置　③インデックス計算：`index = row + column * rows`
- 出力：縦詰めに並んだ配列

#### 4. 配置を整える
- 入力：縦詰めに並んだ要素
- 処理：タブ文字（`join("\t")`）を使用して見やすく整える
- 出力：整えられた文字列
:::

:::details 🧩 タスクばらし ※ 随時、追加・変更あり
- [x] タスク1：開発の準備（テストフォルダ）
  - [x] ToDo：作業用フォルダを用意し、その中にダミーファイルをいくつか置く
  - [x] 作業時間： 30分
  - [x] 終了条件：テストフォルダにファイルがある

- [x] タスク2：全体設計
  - [x] ToDo：「主要な処理」を列挙する
  - [x] 作業時間：60分
  - [x] 終了条件：主要な処理（要件）を一つずつ列挙すること

- [x] タスク3：ファイルの取得とソート（並び替え）
  - [x] ToDo：`.`や`..`から始まるファイルや隠しファイルは出力させないようにする
  - [x] 作業時間：60分
  - [x] 終了条件：期待している並び順になっていること

- [x] タスク4：行数・列数のロジックを考える（余りの切り上げを用いる）
  - [x] ToDo：先ずは列数を3列に決め、行数が切り上げになること
  - [x] 作業時間：60分
  - [x] 終了条件：列数や要素の数を変更しても期待どおりになっていること

- [x] タスク5：縦詰めにロジックをメソッド化
  - [x] ToDo：縦詰めに変換するメソッドを実装し、期待どおりなっていること
  - [x] 作業時間：90分
  - [x] 終了条件：縦詰めの出力が期待どおりであること

- [x] タスク6：列幅を揃える
  - [x] ToDo：タブ文字を用いて文字列同志の幅を整える
  - [x] 作業時間：90分
  - [x] 終了条件：実際に見て読みやすくなっていること

- [ ] タスク7：rubocop-fjord に通す
  - [ ] ToDo：rubocop-fjord 通して出力されたエラーを一つずつ直していく
  - [ ] 作業時間：数時間？エラーの内容によりけり
  - [ ] 終了条件：rubocop-fjord の警告・エラーが発生していないこと

- [ ] タスク8：提出
  - [ ] ToDo：作成した lsコマンドを Pull Request として提出
  - [ ] ToDo：提出物にlsコマンドの実行結果とOS標準（macなど自分の使ってるOS）のlsコマンドをのスクリーンショットを併記して貼る
  - [ ] ToDo：rubocop-fjord のチェックが全てパスした画面をスクショして添付
  - [ ] 作業時間：60分
  - [ ] 終了条件：メンターさんに課題を提出すること
:::


---


### 🧑🏻‍💻 本日の取り組み
#### 🗣️ グループコーチングに参加
- 発表内容の作成
- 2週間の振り返り
- 質疑応答

#### プラクティス『lsコマンドを作る1』🛠️💻
- 行数・列数のロジックを考える（余りの切り上げを用いる）
- 縦詰めにロジックをメソッド化
- 列幅を揃える


---


### ⏭️ 次回
#### プラクティス『lsコマンドを作る1』🛠️💻
- rubocop-fjord に通す


---


### 💡 本日の学び・気付き
:::details ⚠️ ネタバレ注意
### タスク4・タスク5・タスク6
- 行数・列数のロジックを考える（余りの切り上げを用いる）
- 縦詰めにロジックをメソッド化
- 列幅を揃える

#### 上記をそれぞれ実装
```ruby
#!/usr/bin/env ruby
# frozen_string_literal: true

files = Dir.glob('*').sort

columns = 3

rows = (files.size.to_f / columns).ceil

rows.times do |row|
  line = []
  columns.times do |column|
    index = row + column * rows
    if index < files.size
      line << files[index]
    end
  end
  puts line.join("\t")
end
```

#### 出力結果
```shell
% ruby ls.rb
1.txt	4.txt	README.md
10.txt	5.txt	babel.config.js
11.txt	6.txt	bin
12.txt	7.txt	config
13.txt	8.txt	config.ru
14.txt	9.txt	log
15.txt	Gemfile	ls.rb
2.txt	Gemfile.lock	package.json
3.txt	Procfile	postcss.config.js
```
ファイル名の長さで揃っていないため、見た目が崩れている箇所がある。

#### 書き直したコード
```ruby
#!/usr/bin/env ruby
# frozen_string_literal: true

files = Dir.glob('*').sort

columns = 3

rows = (files.size.to_f / columns).ceil

width = files.map(&:length).max
padding = width + 1

rows.times do |row|
  line = []
  columns.times do |column|
    index = row + column * rows
    if index < files.size
      line << files[index].ljust(padding)
    else
      line << ''.ljust(padding)
    end
  end
  puts line.join
end
```
```ruby
width = files.map(&:length).max
```
- 配列`files`の各要素（ファイル名）の長さを取り出して配列にし、そこから最大値を取る。
- 結果は「最も長いファイル名の文字数」になる。例えば`["a.txt", "README.md"]`なら`[5, 9]`となり、`max`は`9`。
- ちなみに`files.map(&:length)`は`&`と**シンボル**で簡潔にした書き方。通常は`files.map { |f| f.length}`と書く。**※ チェリー本 p.114 &とシンボルを使ってもっと簡潔に書く 参照**
```ruby
padding = width + 1
```
- 列幅を決める。`width`（最大の長さ）に`+1`を加えて、列と列との間に1文字分の余白を入れる。例えば`width = 10`なら`padding = 11`。各ファイルは`ljust(11)`でファイル名の右側にスペースを埋める形になる。
```ruby
line << files[index].ljust(padding)
```
- files[index]（文字列）を`ljust(padding)`でファイル名の右側をスペースで埋めて、その文字列を配列`line`に追加（`<<`）する。
- 各列が同じ幅になり、横の並びを揃えることができる。
```ruby
line << ''.ljust(padding)
```
- 空文字`''`を同じ`padding`の幅に揃えた文字列を代わりに入れる。他の列を崩さないようにする。
```ruby
puts line.join
```
- 配列`line`の要素（ファイル名）を空文字`''`で繋げて1つの文字列にして、`puts`で出力する（`puts`メソッドは最後に改行を加えてくれる）。
- `join`は配列の要素を連結して1つの文字列にするメソッド。**※ チェリー本 p. 113 joinとsum 参照**

#### 実行結果
```shell
~/test_file % ruby ls.rb
1.txt             4.txt             README.md         
10.txt            5.txt             babel.config.js   
11.txt            6.txt             bin               
12.txt            7.txt             config            
13.txt            8.txt             config.ru         
14.txt            9.txt             log               
15.txt            Gemfile           ls.rb             
2.txt             Gemfile.lock      package.json      
3.txt             Procfile          postcss.config.js
```
シュ......シュッとなってる（嬉）🥹
:::


---


### ✍🏻 感想
#### 🏄🏻 自然と高まるモチベーション
グループコーチングでは得られるものが本当に多く、毎回いい刺激を受けています。学習へのモチベーションが自然と高まります。グループコーチングはいいぞ（n回目）😊👍🏻

#### 🤔 列幅に悩む
今回の実装でもチェリー本、Rubyリファレンスマニュアルを頼りに進めました。カレンダー問題やボウリング問題を参考にしようとしましたが、ファイル名は短いものから長いものまであり、同じ方法は使えず苦戦。インデックス計算の仕組みを理解するときよりも難しく感じました。

今週中にはメンターさんに課題を提出できるように進めていきたいです。


---


### ⏰ 学習時間
- Today:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 hours 43 min
- Total: 1300 hours 13 min
